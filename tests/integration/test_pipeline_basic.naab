// Integration Test: Pipeline operator basics
// Tests: |> operator, data flow, chaining

use string

function double(x) {
    return x * 2
}

function add_ten(x) {
    return x + 10
}

function sum_array(arr) {
    let total = 0
    for item in arr {
        total = total + item
    }
    return total
}

function subtract_five(x) {
    return x - 5
}

function square(x) {
    return x * x
}

main {
    // Test 1: Simple pipeline
    let result1 = 5 |> double |> add_ten
    if result1 != 20 {
        throw "FAIL: 5 |> double |> add_ten should return 20, got " + result1
    }
    print("PASS: simple pipeline")

    // Test 2: Pipeline with wrapper functions
    fn to_upper(s) { return string.upper(s) }
    fn get_length(s) { return string.length(s) }
    let result2 = "hello world" |> to_upper |> get_length
    if result2 != 11 {
        throw "FAIL: pipeline with string should return length 11, got " + result2
    }
    print("PASS: pipeline with stdlib functions")

    // Test 3: Array pipeline
    let result3 = [1, 2, 3, 4, 5] |> sum_array |> double
    if result3 != 30 {
        throw "FAIL: array pipeline should return 30, got " + result3
    }
    print("PASS: array pipeline")

    // Test 4: Long pipeline chain
    let result4 = 3 |> double |> add_ten |> subtract_five |> square
    if result4 != 121 {
        throw "FAIL: long pipeline should return 121, got " + result4
    }
    print("PASS: long pipeline chain")

    print("All basic pipeline tests passed")
}
