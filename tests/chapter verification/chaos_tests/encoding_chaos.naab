// verification/chaos_tests/encoding_chaos.naab
// Goal: Test emoji, escaping, and encoding through the polyglot bridge.
use io
use json

main {
    print("--- ENCODING CHAOS ---")

    // Test 1: String escaping (\" works in NAAb)
    let quoted = "hello \"world\" test"
    print("Escape test: " + quoted)

    // Test 2: Emoji in strings
    let payload = "üöÄ Sovereign Fabric üõ°Ô∏è"
    print("Payload: " + payload)

    // Test 3: Send emoji through JS bridge
    // NOTE: Use expression (last line), NOT console.log (returns undefined)
    let result = <<javascript[payload]
    JSON.stringify({ "received": payload })
    >>

    if result == null {
        print("BUG: JS bridge returned null!")
        return
    }

    let parsed = json.parse(result)
    print("JS returned: " + parsed["received"])

    if parsed["received"] == payload {
        print("PASS: Encoding integrity verified")
    } else {
        print("FAIL: Character corruption detected!")
    }

    // Test 4: Emoji through Python bridge
    let py_result = <<python[payload]
payload + " ‚ú®"
>>
    print("Python returned: " + py_result)
    if py_result == payload + " ‚ú®" {
        print("PASS: Python emoji integrity verified")
    } else {
        print("FAIL: Python emoji corruption!")
    }

    // Test 5: Backslash handling
    let bs = "path\\to\\file"
    let bs_result = <<python[bs]
bs
>>
    if bs_result == bs {
        print("PASS: Backslash integrity verified")
    } else {
        print("FAIL: Backslash corruption ‚Äî got: " + bs_result)
    }
}
