// NAAb Arithmetic Overflow Security Tests
// Tests safe arithmetic operations to prevent integer overflow vulnerabilities

fn testAdditionOverflow() {
    print("Testing addition overflow detection...")

    let x = 1000 + 2000
    if x != 3000 { throw "Normal addition should work" }

    try {
        let max_int = 9223372036854775807
        let overflow = max_int + 1
        throw "Should have thrown overflow exception"
    } catch (e) {
        print("  Caught overflow: " + e)
    }
}

fn testSubtractionUnderflow() {
    print("Testing subtraction underflow detection...")

    let x = 5000 - 2000
    if x != 3000 { throw "Normal subtraction should work" }

    try {
        let min_int = -9223372036854775808
        let underflow = min_int - 1
        throw "Should have thrown underflow exception"
    } catch (e) {
        print("  Caught underflow: " + e)
    }
}

fn testMultiplicationOverflow() {
    print("Testing multiplication overflow detection...")

    let x = 100 * 50
    if x != 5000 { throw "Normal multiplication should work" }

    try {
        let large = 9223372036854775807
        let overflow = large * 2
        throw "Should have thrown overflow exception"
    } catch (e) {
        print("  Caught overflow: " + e)
    }
}

fn testDivisionByZero() {
    print("Testing division by zero detection...")

    let x = 100 / 5
    if x != 20 { throw "Normal division should work" }

    try {
        let result = 100 / 0
        throw "Should have thrown division by zero exception"
    } catch (e) {
        print("  Caught division by zero: " + e)
    }
}

fn testModuloByZero() {
    print("Testing modulo by zero detection...")

    let x = 100 % 7
    if x != 2 { throw "Normal modulo should work" }

    try {
        let result = 100 % 0
        throw "Should have thrown modulo by zero exception"
    } catch (e) {
        print("  Caught modulo by zero: " + e)
    }
}

fn testNegationOverflow() {
    print("Testing negation overflow detection...")

    let x = -1000
    let y = -x
    if y != 1000 { throw "Normal negation should work" }

    try {
        let min_int = -9223372036854775808
        let overflow = -min_int
        throw "Should have thrown overflow exception"
    } catch (e) {
        print("  Caught negation overflow: " + e)
    }
}

fn testArrayBoundsChecking() {
    print("Testing array bounds checking...")

    let arr = [10, 20, 30, 40, 50]

    if arr[0] != 10 { throw "Index 0 should work" }
    if arr[4] != 50 { throw "Index 4 should work" }

    try {
        let invalid = arr[10]
        throw "Should have thrown out of range exception"
    } catch (e) {
        print("  Caught out of bounds: " + e)
    }

    try {
        let invalid = arr[-1]
        throw "Should have thrown negative index exception"
    } catch (e) {
        print("  Caught negative index: " + e)
    }
}

main {
    print("=== Arithmetic Overflow Security Tests ===")

    testAdditionOverflow()
    testSubtractionUnderflow()
    testMultiplicationOverflow()
    testDivisionByZero()
    testModuloByZero()
    testNegationOverflow()
    testArrayBoundsChecking()

    print("")
    print("All arithmetic overflow tests completed!")
}
