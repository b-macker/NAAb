// Test: Finally blocks should preserve return values from try/catch
// This verifies the fix for the critical bug where finally blocks caused functions to return null

struct Result<T> {
    success: bool,
    data: T?,
    error_msg: string?
}

fn test_finally_with_return() -> Result<string> {
    try {
        return new Result<string> {
            success: true,
            data: "success_value",
            error_msg: null
        }
    } catch (e) {
        return new Result<string> {
            success: false,
            data: null,
            error_msg: "error_value"
        }
    } finally {
        print("Finally executed")
    }
}

fn test_finally_with_catch_return() -> Result<string> {
    try {
        throw "Test error"
    } catch (e) {
        return new Result<string> {
            success: false,
            data: null,
            error_msg: "caught_error"
        }
    } finally {
        print("Finally after catch")
    }
}

main {
    print("Test 1: Finally with try return")
    let result1 = test_finally_with_return()
    if result1.success && result1.data == "success_value" {
        print("✓ PASS: Finally preserved try return")
    } else {
        print("✗ FAIL: Finally broke try return")
    }

    print("\nTest 2: Finally with catch return")
    let result2 = test_finally_with_catch_return()
    if !result2.success && result2.error_msg == "caught_error" {
        print("✓ PASS: Finally preserved catch return")
    } else {
        print("✗ FAIL: Finally broke catch return")
    }
}
