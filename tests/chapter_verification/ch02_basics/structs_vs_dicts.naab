// Chapter 2: Structs vs. Dictionaries Verification
// Demonstrates the differences and correct usage patterns

use io
use json

// Define a struct with known fields
struct Person {
    name: string
    age: int
    email: string
}

main {
    io.write("=== Structs vs. Dictionaries Comparison ===\n\n")

    // TEST 1: Struct with dot notation
    io.write("TEST 1: Struct with dot notation\n")
    let alice = new Person {
        name: "Alice",
        age: 30,
        email: "alice@example.com"
    }

    io.write("  Struct field access: ", alice.name, " (age: ", alice.age, ")\n")
    alice.age = 31
    io.write("  After modification: ", alice.age, "\n")
    io.write("  ✓ Structs use dot notation\n\n")

    // TEST 2: Dictionary with bracket notation
    io.write("TEST 2: Dictionary with bracket notation\n")
    let bob = {
        "name": "Bob",
        "age": 25,
        "email": "bob@example.com"
    }

    io.write("  Dict value access: ", bob["name"], " (age: ", bob["age"], ")\n")
    bob["age"] = 26
    io.write("  After modification: ", bob["age"], "\n")
    io.write("  ✓ Dictionaries use bracket notation\n\n")

    // TEST 3: Dynamic dictionary keys
    io.write("TEST 3: Dynamic dictionary keys\n")
    bob["department"] = "Engineering"
    bob["role"] = "Developer"
    io.write("  Added dynamic keys: department=", bob["department"], ", role=", bob["role"], "\n")
    io.write("  ✓ Dictionaries support dynamic keys\n\n")

    // TEST 4: Quoted vs unquoted keys
    io.write("TEST 4: Dictionary keys must be quoted\n")
    let settings = {
        "debug_mode": true,
        "max_connections": 100,
        "timeout": 30.5
    }
    io.write("  Settings debug_mode: ", settings["debug_mode"], "\n")
    io.write("  ✓ Keys are quoted strings\n\n")

    // TEST 5: Struct type safety (demonstrated by successful compile)
    io.write("TEST 5: Struct type safety\n")
    let charlie = new Person {
        name: "Charlie",
        age: 28,
        email: "charlie@example.com"
    }
    // charlie.age = "twenty-eight"  // Would be compile error!
    io.write("  Charlie age: ", charlie.age, " (type-safe int)\n")
    io.write("  ✓ Structs enforce types at compile-time\n\n")

    // TEST 6: Dictionary flexibility
    io.write("TEST 6: Dictionary flexibility\n")
    let flexible = {
        "string_val": "text",
        "int_val": 42,
        "bool_val": true,
        "float_val": 3.14
    }
    io.write("  Mixed types: ", flexible["string_val"], ", ", flexible["int_val"], "\n")
    io.write("  ✓ Dictionaries allow mixed value types\n\n")

    // TEST 7: Comparison table summary
    io.write("=== Summary ===\n")
    io.write("Struct syntax:     let obj = new Type { field: value }\n")
    io.write("Struct access:     obj.field\n")
    io.write("Struct keys:       Unquoted identifiers\n")
    io.write("Dict syntax:       let dict = {\"key\": value}\n")
    io.write("Dict access:       dict[\"key\"]\n")
    io.write("Dict keys:         Quoted strings\n\n")

    io.write("=== All tests passed! ===\n")
}

// Anti-patterns (DO NOT UNCOMMENT - these would cause errors):
//
// fn demonstrate_errors() {
//     let person = new Person { name: "Test", age: 20, email: "test@example.com" }
//     io.write(person["name"])  // ERROR: Can't use brackets on structs
//
//     let data = {"name": "Test", "age": 20}
//     io.write(data.name)  // ERROR: Can't use dot notation on dicts
//
//     let broken = {
//         name: "Test",  // ERROR: Unquoted key treated as variable
//         age: 20
//     }
// }
