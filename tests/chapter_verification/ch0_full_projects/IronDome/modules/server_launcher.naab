// IronDome/modules/server_launcher.naab
// Background Server Orchestrator
// Uses: <<go>>, <<bash>>, io

use io

export fn start_server(root_dir, port) {
    let port_str = "" + port
    // We use a bash command to start a persistent Go file server in the background
    let cmd = "go run -e 'package main; import "net/http"; func main() { http.Handle("/", http.FileServer(http.Dir("" + root_dir + ""))); http.ListenAndServe(":" + port_str + "", nil) }' &"
    
    // In our environment, we use run_shell_command via the agent, but for NAAb sovereignty:
    io.write("    [SYSTEM] Launching Sovereign Web Server on port ", port_str, "...
")
    return {
        "command": cmd,
        "url": "http://localhost:" + port_str
    }
}
