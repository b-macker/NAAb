# Phase 3.2: Garbage Collection Test with Manual Trigger
# Tests the mark-and-sweep cycle detector with gc_collect()

struct Node {
    value: int
    next: Node?
}

main {
    print("=== Garbage Collection Test ==")
    print("")

    print("Creating two nodes...")
    let a = new Node { value: 1, next: null }
    let b = new Node { value: 2, next: null }

    print("Linking: a.next = b")
    a.next = b

    print("Creating cycle: b.next = a")
    b.next = a

    print("")
    print("Cycle created! Both nodes have refcount=2")
    print("Node a.value =", a.value)
    print("Node b.value =", b.value)

    print("")
    print("Now manually triggering garbage collection...")
    gc_collect()

    print("")
    print("GC completed!")
    print("Note: Cycle is still accessible (a and b still in scope)")
    print("Cycle will only be collected after main() exits")
}
