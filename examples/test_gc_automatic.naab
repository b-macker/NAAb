// Phase 3.2: Test Automatic Garbage Collection
// This test creates many allocations to trigger automatic GC

struct Node {
    value: int,
    next: Node?
}

fn main() {
    println("=== Automatic Garbage Collection Test ===\n");

    println("Creating many allocations to trigger automatic GC...");
    println("GC threshold is set to 1000 allocations by default.\n");

    // Create a large number of allocations
    // This will trigger automatic GC when threshold is reached
    let count = 150;  // Create 150 nodes (each node = multiple allocations)

    println("Creating " + str(count) + " nodes in a loop...\n");

    let i = 0;
    while i < count {
        // Each iteration creates multiple Values:
        // - Node struct instance
        // - value field (int)
        // - next field (null)
        // Plus temporary values from expressions
        let node = new Node { value: i, next: null };

        if i % 25 == 0 {
            println("Created " + str(i) + " nodes so far...");
        }

        i = i + 1;
    }

    println("\nâœ… Created " + str(count) + " nodes successfully!");
    println("If automatic GC is working, you should see GC messages above.");
    println("\nNote: With threshold=1000, GC may not trigger for small tests.");
    println("To see automatic GC in action, either:");
    println("  1. Increase the loop count to 1000+");
    println("  2. Or lower the GC threshold (requires code change)");
}
