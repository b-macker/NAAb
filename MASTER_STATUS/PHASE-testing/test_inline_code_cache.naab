// Test inline code caching - Phase 3.3.1
use time as time

main {
    print("=== Testing Inline Code Caching ===\n")

    // Test 1: First run (cache miss)
    print("Test 1: First execution (cache miss)")
    let start1 = time.now_millis()

    let result1 = <<cpp 42 + 58 >>

    let end1 = time.now_millis()
    let time1 = end1 - start1
    print("  Result: ", result1)
    print("  Time: ", time1, " ms\n")

    // Test 2: Second run (should be cache hit)
    print("Test 2: Second execution (cache hit expected)")
    let start2 = time.now_millis()

    let result2 = <<cpp 42 + 58 >>

    let end2 = time.now_millis()
    let time2 = end2 - start2
    print("  Result: ", result2)
    print("  Time: ", time2, " ms\n")

    // Test 3: Different code (cache miss)
    print("Test 3: Different code (cache miss)")
    let start3 = time.now_millis()

    let result3 = <<cpp 10 * 20 >>

    let end3 = time.now_millis()
    let time3 = end3 - start3
    print("  Result: ", result3)
    print("  Time: ", time3, " ms\n")

    // Test 4: Same as Test 3 (cache hit)
    print("Test 4: Same as Test 3 (cache hit expected)")
    let start4 = time.now_millis()

    let result4 = <<cpp 10 * 20 >>

    let end4 = time.now_millis()
    let time4 = end4 - start4
    print("  Result: ", result4)
    print("  Time: ", time4, " ms\n")

    // Performance comparison
    print("=== Performance Summary ===")
    print("First execution:  ", time1, " ms")
    print("Second execution: ", time2, " ms")

    if time2 < time1 {
        let improvement = ((time1 - time2) * 100) / time1
        print("Speedup: ", improvement, "% faster (cache hit!)")
    }

    print("\nThird execution:  ", time3, " ms")
    print("Fourth execution: ", time4, " ms")

    if time4 < time3 {
        let improvement2 = ((time3 - time4) * 100) / time3
        print("Speedup: ", improvement2, "% faster (cache hit!)")
    }

    print("\nâœ“ Cache test complete!")
}
