// Integration Test: Pipeline operator basics
// Tests: |> operator, data flow, chaining

import "stdlib" as std

// Test 1: Simple pipeline
function double(x) {
    return x * 2
}

function add_ten(x) {
    return x + 10
}

let result1 = 5 |> double |> add_ten
if (result1 != 20) {
    throw "FAIL: 5 |> double |> add_ten should return 20, got " + result1
}
print("PASS: simple pipeline")

// Test 2: Pipeline with stdlib functions
let result2 = "hello world" |> std.toUpperCase |> std.length
if (result2 != 11) {
    throw "FAIL: pipeline with stdlib should return 11, got " + result2
}
print("PASS: pipeline with stdlib functions")

// Test 3: Array pipeline
function sum_array(arr) {
    let total = 0
    for (item in arr) {
        total = total + item
    }
    return total
}

let result3 = [1, 2, 3, 4, 5] |> sum_array |> double
if (result3 != 30) {
    throw "FAIL: array pipeline should return 30, got " + result3
}
print("PASS: array pipeline")

// Test 4: Long pipeline chain
function subtract_five(x) {
    return x - 5
}

function square(x) {
    return x * x
}

let result4 = 3 |> double |> add_ten |> subtract_five |> square
if (result4 != 121) {
    throw "FAIL: long pipeline should return 121, got " + result4
}
print("PASS: long pipeline chain")

print("âœ“ All basic pipeline tests passed")
