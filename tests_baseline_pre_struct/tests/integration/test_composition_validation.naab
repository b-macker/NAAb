// Integration Test: Block composition validation
// Tests: Type checking, adapter suggestions, error messages

// Note: This test requires the CompositionValidator to be accessible
// For now, we'll test the conceptual workflow

import "stdlib" as std

print("Testing block composition validation workflow...")

// Test 1: Compatible types should compose
function process_string(str) {
    return std.toUpperCase(str)
}

function count_length(str) {
    return std.length(str)
}

// String -> String -> Int pipeline (compatible)
let result1 = "hello" |> process_string |> count_length
if (result1 != 5) {
    throw "FAIL: compatible composition should work, got " + result1
}
print("PASS: compatible type composition")

// Test 2: Type transformation pipeline
function to_string(x) {
    return std.toString(x)
}

function parse_int(str) {
    return std.parseInt(str)
}

// Int -> String -> Int (requires explicit conversion)
let result2 = 42 |> to_string |> parse_int
if (result2 != 42) {
    throw "FAIL: type transformation should work, got " + result2
}
print("PASS: type transformation in pipeline")

// Test 3: Array transformation pipeline
function numbers_to_strings(arr) {
    return std.map_fn(arr, function(x) { return std.toString(x) })
}

function concat_strings(arr) {
    return std.join(arr, ",")
}

// Array<Int> -> Array<String> -> String
let result3 = [1, 2, 3] |> numbers_to_strings |> concat_strings
if (result3 != "1,2,3") {
    throw "FAIL: array transformation pipeline failed, got " + result3
}
print("PASS: array type transformation pipeline")

// Test 4: Complex data flow
function create_range(n) {
    let result = []
    let i = 0
    while (i < n) {
        result = std.push(result, i + 1)
        i = i + 1
    }
    return result
}

function sum_array(arr) {
    return std.reduce_fn(arr, function(acc, x) { return acc + x }, 0)
}

// Int -> Array<Int> -> Int
let result4 = 5 |> create_range |> sum_array
if (result4 != 15) {
    throw "FAIL: complex data flow failed, got " + result4
}
print("PASS: complex data flow composition")

print("âœ“ All composition validation tests passed")
