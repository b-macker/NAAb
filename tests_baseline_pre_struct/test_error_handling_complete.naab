// Test: Comprehensive Error Handling
// Tests: try/catch/finally, throw, error propagation, stack traces

print("=== Test 1: Basic Try/Catch ===")

try {
    print("In try block")
    throw "Simple error"
    print("This should not print")
} catch (e) {
    print("Caught error:", e)  // Expected: Caught error: Simple error
}

print("\n=== Test 2: Try/Finally (no error) ===")

let finallyExecuted = false
try {
    print("Try block executed")
} finally {
    print("Finally block executed")
    finallyExecuted = true
}
print("Finally was executed:", finallyExecuted)  // Expected: true

print("\n=== Test 3: Try/Catch/Finally ===")

try {
    print("Starting operation...")
    throw "Operation failed"
} catch (e) {
    print("Error caught:", e)
} finally {
    print("Cleanup completed")
}

print("\n=== Test 4: Error Propagation ===")

function innerFunction() {
    throw "Error from innerFunction"
}

function middleFunction() {
    innerFunction()
}

function outerFunction() {
    try {
        middleFunction()
    } catch (e) {
        print("Caught in outerFunction:", e)
    }
}

outerFunction()

print("\n=== Test 5: Re-throwing Errors ===")

try {
    try {
        throw "Original error"
    } catch (e) {
        print("Inner catch:", e)
        throw "Re-thrown error"
    }
} catch (e) {
    print("Outer catch:", e)  // Expected: Re-thrown error
}

print("\n=== Test 6: Finally Overrides Return ===")

function testFinally() {
    try {
        return "try return"
    } finally {
        print("Finally executed after return")
    }
}

let result = testFinally()
print("Function returned:", result)

print("\n=== Test 7: Multiple Catch Attempts ===")

let attempts = 0
while (attempts < 3) {
    try {
        attempts = attempts + 1
        if (attempts < 3) {
            print("Attempt", attempts, "failed")
            throw "Retry needed"
        }
        print("Attempt", attempts, "succeeded!")
    } catch (e) {
        if (attempts >= 3) {
            print("Max retries exceeded")
        }
    }
}

print("\n=== Test 8: Error in Function with Cleanup ===")

function processData(data) {
    print("Processing started...")
    try {
        if (data == null) {
            throw "Data is null"
        }
        print("Data processed:", data)
        return data * 2
    } catch (e) {
        print("Error during processing:", e)
        return -1
    } finally {
        print("Cleanup: resources released")
    }
}

let goodResult = processData(5)
print("Result:", goodResult)  // Expected: 10

let badResult = processData(null)
print("Result:", badResult)   // Expected: -1

print("\n=== All Error Handling Tests Passed ===")
