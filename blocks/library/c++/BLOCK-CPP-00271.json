{
  "code": "    #include <spdlog/details/os.h>\n#include <spdlog/common.h>\n#include <algorithm>\n#include <array>\n#include <chrono>\n#include <cstdio>\n#include <cstdlib>\n#include <cstring>\n#include <ctime>\n#include <string>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <thread>\n    #include <spdlog/details/windows_include.h>\n    #include <fileapi.h>  // for FlushFileBuffers\n    #include <io.h>       // for _get_osfhandle, _isatty, _fileno\n    #include <process.h>  // for _get_pid\n        #include <share.h>\n        #include <cassert>\n        #include <limits>\n    #include <direct.h>  // for _mkdir/_wmkdir\n    #include <fcntl.h>\n    #include <unistd.h>\n        #include <sys/syscall.h>  //Use gettid() syscall under linux to get thread id\n        #include <pthread.h>  // for pthread_getthrds_np\n        #include <pthread_np.h>  // for pthread_getthreadid_np\n        #include <lwp.h>  // for _lwp_self\n        #include <thread.h>  // for thr_self\n    #include <AvailabilityMacros.h>\n\nusing namespace spdlog;\nusing namespace details;\nusing namespace os;\n\nextern \"C\" {\n\nvoid BLOCK-CPP-00271_execute() {\n    {\n    if (f == nullptr) {\n        throw_spdlog_ex(\"Failed getting file size. fd is null\");\n    }\n#if defined(_WIN32) && !defined(__CYGWIN__)\n    int fd = ::_fileno(f);\n    #if defined(_WIN64)  // 64 bits\n    __int64 ret = ::_filelengthi64(fd);\n    if (ret >= 0) {\n        return static_cast<size_t>(ret);\n    }\n\n    #else  // windows 32 bits\n    long ret = ::_filelength(fd);\n    if (ret >= 0) {\n        return static_cast<size_t>(ret);\n    }\n    #endif\n\n#else  // unix\n    // OpenBSD and AIX doesn't compile with :: before the fileno(..)\n    #if defined(__OpenBSD__) || defined(_AIX)\n    int fd = fileno(f);\n    #else\n    int fd = ::fileno(f);\n    #endif\n    // 64 bits(but not in osx, linux/musl or cygwin, where fstat64 is deprecated)\n    #if ((defined(__linux__) && defined(__GLIBC__)) || defined(__sun) || defined(_AIX)) && \\\n        (defined(__LP64__) || defined(_LP64))\n    struct stat64 st;\n    if (::fstat64(fd, &st) == 0) {\n        return static_cast<size_t>(st.st_size);\n    }\n    #else  // other unix or linux 32 bits or cygwin\n    struct stat st;\n    if (::fstat(fd, &st) == 0) {\n        return static_cast<size_t>(st.st_size);\n    }\n    #endif\n#endif\n    throw_spdlog_ex(\"Failed getting file size from fd\", errno);\n    return 0;  // will not be reached.\n}\n}\n\n} // extern \"C\"\n",
  "id": "BLOCK-CPP-00271",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/spdlog/include/spdlog/details/os-inl.h",
  "source_line": 199,
  "validation_status": "validated"
}