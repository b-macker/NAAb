{
  "code": "{\n\nnamespace {\n\n// The prefix used for the internal names of fixed-offset zones.\nconst char kFixedZonePrefix[] = \"Fixed/UTC\";\n\nconst char kDigits[] = \"0123456789\";\n\nchar* Format02d(char* p, int v) {\n  *p++ = kDigits[(v / 10) % 10];\n  *p++ = kDigits[v % 10];\n  return p;\n}\n\nint Parse02d(const char* p) {\n  if (const char* ap = std::strchr(kDigits, *p)) {\n    int v = static_cast<int>(ap - kDigits);\n    if (const char* bp = std::strchr(kDigits, *++p)) {\n      return (v * 10) + static_cast<int>(bp - kDigits);\n    }\n  }\n  return -1;\n}\n\n}  // namespace\n\nbool FixedOffsetFromName(const std::string& name, seconds* offset) {\n  if (name == \"UTC\" || name == \"UTC0\") {\n    *offset = seconds::zero();\n    return true;\n  }\n\n  const std::size_t prefix_len = sizeof(kFixedZonePrefix) - 1;\n  const char* const ep = kFixedZonePrefix + prefix_len;\n  if (name.size() != prefix_len + 9)  // <prefix>+99:99:99\n    return false;\n  if (!std::equal(kFixedZonePrefix, ep, name.begin())) return false;\n  const char* np = name.data() + prefix_len;\n  if (np[0] != '+' && np[0] != '-') return false;\n  if (np[3] != ':' || np[6] != ':')  // see note below about large offsets\n    return false;\n\n  int hours = Parse02d(np + 1);\n  if (hours == -1) return false;\n  int mins = Parse02d(np + 4);\n  if (mins == -1) return false;\n  int secs = Parse02d(np + 7);\n  if (secs == -1) return false;\n\n  secs += ((hours * 60) + mins) * 60;\n  if (secs > 24 * 60 * 60) return false;  // outside supported offset range\n  *offset = seconds(secs * (np[0] == '-' ? -1 : 1));  // \"-\" means west\n  return true;\n}\n\nstd::string FixedOffsetToName(const seconds& offset) {\n  if (offset == seconds::zero()) return \"UTC\";\n  if (offset < std::chrono::hours(-24) || offset > std::chrono::hours(24)) {\n    // We don't support fixed-offset zones more than 24 hours\n    // away from UTC to avoid complications in rendering such\n    // offsets and to (somewhat) limit the total number of zones.\n    return \"UTC\";\n  }\n  int offset_seconds = static_cast<int>(offset.count());\n  const char sign = (offset_seconds < 0 ? '-' : '+');\n  int offset_minutes = offset_seconds / 60;\n  offset_seconds %= 60;\n  if (sign == '-') {\n    if (offset_seconds > 0) {\n      offset_seconds -= 60;\n      offset_minutes += 1;\n    }\n    offset_seconds = -offset_seconds;\n    offset_minutes = -offset_minutes;\n  }\n  int offset_hours = offset_minutes / 60;\n  offset_minutes %= 60;\n  const std::size_t prefix_len = sizeof(kFixedZonePrefix) - 1;\n  char buf[prefix_len + sizeof(\"-24:00:00\")];\n  char* ep = std::copy_n(kFixedZonePrefix, prefix_len, buf);\n  *ep++ = sign;\n  ep = Format02d(ep, offset_hours);\n  *ep++ = ':';\n  ep = Format02d(ep, offset_minutes);\n  *ep++ = ':';\n  ep = Format02d(ep, offset_seconds);\n  *ep++ = '\\0';\n  assert(ep == buf + sizeof(buf));\n  return buf;\n}\n\nstd::string FixedOffsetToAbbr(const seconds& offset) {\n  std::string abbr = FixedOffsetToName(offset);\n  const std::size_t prefix_len = sizeof(kFixedZonePrefix) - 1;\n  if (abbr.size() == prefix_len + 9) {         // <prefix>+99:99:99\n    abbr.erase(0, prefix_len);                 // +99:99:99\n    abbr.erase(6, 1);                          // +99:9999\n    abbr.erase(3, 1);                          // +999999\n    if (abbr[5] == '0' && abbr[6] == '0') {    // +999900\n      abbr.erase(5, 2);                        // +9999\n      if (abbr[3] == '0' && abbr[4] == '0') {  // +9900\n        abbr.erase(3, 2);                      // +99\n      }\n    }\n  }\n  return abbr;\n}\n\n}",
  "id": "BLOCK-CPP-03207",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/abseil/absl/time/internal/cctz/src/time_zone_fixed.cc",
  "source_line": 28,
  "validation_status": "validated"
}