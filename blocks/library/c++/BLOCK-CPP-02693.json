{
  "code": "{\nABSL_NAMESPACE_BEGIN\nnamespace log_internal {\nnamespace {\n\n// The following code behaves like AtomicStatsCounter::LossyAdd() for\n// speed since it is fine to lose occasional updates.\n// Returns old value of *counter.\nuint32_t LossyIncrement(std::atomic<uint32_t>* counter) {\n  const uint32_t value = counter->load(std::memory_order_relaxed);\n  counter->store(value + 1, std::memory_order_relaxed);\n  return value;\n}\n\n}  // namespace\n\nbool LogEveryNState::ShouldLog(int n) {\n  return n > 0 && (LossyIncrement(&counter_) % static_cast<uint32_t>(n)) == 0;\n}\n\nbool LogFirstNState::ShouldLog(int n) {\n  const uint32_t counter_value = counter_.load(std::memory_order_relaxed);\n  if (static_cast<int64_t>(counter_value) < n) {\n    counter_.store(counter_value + 1, std::memory_order_relaxed);\n    return true;\n  }\n  return false;\n}\n\nbool LogEveryPow2State::ShouldLog() {\n  const uint32_t new_value = LossyIncrement(&counter_) + 1;\n  return (new_value & (new_value - 1)) == 0;\n}\n\nbool LogEveryNSecState::ShouldLog(double seconds) {\n  using absl::base_internal::CycleClock;\n  LossyIncrement(&counter_);\n  const int64_t now_cycles = CycleClock::Now();\n  int64_t next_cycles = next_log_time_cycles_.load(std::memory_order_relaxed);\n#if defined(__myriad2__)\n  // myriad2 does not have 8-byte compare and exchange.  Use a racy version that\n  // is \"good enough\" but will over-log in the face of concurrent logging.\n  if (now_cycles > next_cycles) {\n    next_log_time_cycles_.store(now_cycles + seconds * CycleClock::Frequency(),\n                                std::memory_order_relaxed);\n    return true;\n  }\n  return false;\n#else\n  do {\n    if (now_cycles <= next_cycles) return false;\n  } while (!next_log_time_cycles_.compare_exchange_weak(\n      next_cycles, now_cycles + seconds * CycleClock::Frequency(),\n      std::memory_order_relaxed, std::memory_order_relaxed));\n  return true;\n#endif\n}\n\n}  // namespace log_internal\nABSL_NAMESPACE_END\n}",
  "id": "BLOCK-CPP-02693",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/abseil/absl/log/internal/conditions.cc",
  "source_line": 23,
  "validation_status": "validated"
}