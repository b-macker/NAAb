{
  "code": "#include \"absl/log/scoped_mock_log.h\"\n#include <atomic>\n#include <string>\n#include \"gmock/gmock.h\"\n#include \"absl/base/config.h\"\n#include \"absl/base/internal/raw_logging.h\"\n#include \"absl/log/log_entry.h\"\n#include \"absl/log/log_sink.h\"\n#include \"absl/log/log_sink_registry.h\"\n#include \"absl/strings/string_view.h\"\n\nusing namespace absl;\n\nextern \"C\" {\n\nvoid BLOCK-CPP-01789_execute() {\n    {\nABSL_NAMESPACE_BEGIN\n\nScopedMockLog::ScopedMockLog(MockLogDefault default_exp)\n    : sink_(this), is_capturing_logs_(false), is_triggered_(false) {\n  if (default_exp == MockLogDefault::kIgnoreUnexpected) {\n    // Ignore all calls to Log we did not set expectations for.\n    EXPECT_CALL(*this, Log).Times(::testing::AnyNumber());\n  } else {\n    // Disallow all calls to Log we did not set expectations for.\n    EXPECT_CALL(*this, Log).Times(0);\n  }\n  // By default Send mock forwards to Log mock.\n  EXPECT_CALL(*this, Send)\n      .Times(::testing::AnyNumber())\n      .WillRepeatedly([this](const absl::LogEntry& entry) {\n        is_triggered_.store(true, std::memory_order_relaxed);\n        Log(entry.log_severity(), std::string(entry.source_filename()),\n            std::string(entry.text_message()));\n      });\n\n  // By default We ignore all Flush calls.\n  EXPECT_CALL(*this, Flush).Times(::testing::AnyNumber());\n}\n\nScopedMockLog::~ScopedMockLog() {\n  ABSL_RAW_CHECK(is_triggered_.load(std::memory_order_relaxed),\n                 \"Did you forget to call StartCapturingLogs()?\");\n\n  if (is_capturing_logs_) StopCapturingLogs();\n}\n\nvoid ScopedMockLog::StartCapturingLogs() {\n  ABSL_RAW_CHECK(!is_capturing_logs_,\n                 \"StartCapturingLogs() can be called only when the \"\n                 \"absl::ScopedMockLog object is not capturing logs.\");\n\n  is_capturing_logs_ = true;\n  is_triggered_.store(true, std::memory_order_relaxed);\n  absl::AddLogSink(&sink_);\n}\n\nvoid ScopedMockLog::StopCapturingLogs() {\n  ABSL_RAW_CHECK(is_capturing_logs_,\n                 \"StopCapturingLogs() can be called only when the \"\n                 \"absl::ScopedMockLog object is capturing logs.\");\n\n  is_capturing_logs_ = false;\n  absl::RemoveLogSink(&sink_);\n}\n\nabsl::LogSink& ScopedMockLog::UseAsLocalSink() {\n  is_triggered_.store(true, std::memory_order_relaxed);\n  return sink_;\n}\n\nABSL_NAMESPACE_END\n}\n}\n\n} // extern \"C\"\n",
  "id": "BLOCK-CPP-01789",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/abseil/absl/log/scoped_mock_log.cc",
  "source_line": 29,
  "validation_status": "validated"
}