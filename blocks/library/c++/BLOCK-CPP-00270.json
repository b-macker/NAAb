{
  "code": "    #include <spdlog/details/os.h>\n#include <spdlog/common.h>\n#include <algorithm>\n#include <array>\n#include <chrono>\n#include <cstdio>\n#include <cstdlib>\n#include <cstring>\n#include <ctime>\n#include <string>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <thread>\n    #include <spdlog/details/windows_include.h>\n    #include <fileapi.h>  // for FlushFileBuffers\n    #include <io.h>       // for _get_osfhandle, _isatty, _fileno\n    #include <process.h>  // for _get_pid\n        #include <share.h>\n        #include <cassert>\n        #include <limits>\n    #include <direct.h>  // for _mkdir/_wmkdir\n    #include <fcntl.h>\n    #include <unistd.h>\n        #include <sys/syscall.h>  //Use gettid() syscall under linux to get thread id\n        #include <pthread.h>  // for pthread_getthrds_np\n        #include <pthread_np.h>  // for pthread_getthreadid_np\n        #include <lwp.h>  // for _lwp_self\n        #include <thread.h>  // for thr_self\n    #include <AvailabilityMacros.h>\n\nusing namespace spdlog;\nusing namespace details;\nusing namespace os;\n\nextern \"C\" {\n\nvoid BLOCK-CPP-00270_execute() {\n    {\n#ifdef _WIN32\n    #ifdef SPDLOG_WCHAR_FILENAMES\n    *fp = ::_wfsopen((filename.c_str()), mode.c_str(), _SH_DENYNO);\n    #else\n    *fp = ::_fsopen((filename.c_str()), mode.c_str(), _SH_DENYNO);\n    #endif\n    #if defined(SPDLOG_PREVENT_CHILD_FD)\n    if (*fp != nullptr) {\n        auto file_handle = reinterpret_cast<HANDLE>(_get_osfhandle(::_fileno(*fp)));\n        if (!::SetHandleInformation(file_handle, HANDLE_FLAG_INHERIT, 0)) {\n            ::fclose(*fp);\n            *fp = nullptr;\n        }\n    }\n    #endif\n#else  // unix\n    #if defined(SPDLOG_PREVENT_CHILD_FD)\n    const int mode_flag = mode == SPDLOG_FILENAME_T(\"ab\") ? O_APPEND : O_TRUNC;\n    const int fd =\n        ::open((filename.c_str()), O_CREAT | O_WRONLY | O_CLOEXEC | mode_flag, mode_t(0644));\n    if (fd == -1) {\n        return true;\n    }\n    *fp = ::fdopen(fd, mode.c_str());\n    if (*fp == nullptr) {\n        ::close(fd);\n    }\n    #else\n    *fp = ::fopen((filename.c_str()), mode.c_str());\n    #endif\n#endif\n\n    return *fp == nullptr;\n}\n}\n\n} // extern \"C\"\n",
  "id": "BLOCK-CPP-00270",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/spdlog/include/spdlog/details/os-inl.h",
  "source_line": 121,
  "validation_status": "validated"
}