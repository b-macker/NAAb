{
  "code": "#include <stdint.h>\n#include <atomic>\n#include \"absl/base/optimization.h\"\n#include \"absl/profiling/internal/exponential_biased.h\"\n\nusing namespace absl;\nusing namespace profiling_internal;\n\nextern \"C\" {\n\nvoid BLOCK-CPP-05825_execute() {\n    {\n  //     if (!sampler.SubtleConfirmSample())) {\n  //       // Spurious false positive\n  //       FrobberImpl();\n  //       return;\n  //     }\n  //\n  //     // Sampled execution\n  //     // ...\n  //   }\n  inline bool SubtleMaybeSample() noexcept;\n  bool SubtleConfirmSample() noexcept;\n\n protected:\n  // We explicitly don't use a virtual destructor as this class is never\n  // virtually destroyed, and it keeps the class trivial, which avoids TLS\n  // prologue and epilogue code for our TLS instances.\n  ~PeriodicSamplerBase() = default;\n\n  // Returns the next stride for our sampler.\n  // This function is virtual for testing purposes only.\n  virtual int64_t GetExponentialBiased(int period) noexcept;\n\n private:\n  // Returns the current period of this sampler. Thread-safe.\n  virtual int period() const noexcept = 0;\n\n  // Keep and decrement stride_ as an unsigned integer, but compare the value\n  // to zero casted as a signed int. clang and msvc do not create optimum code\n  // if we use signed for the combined decrement and sign comparison.\n  //\n  // Below 3 alternative options, all compiles generate the best code\n  // using the unsigned increment <---> signed int comparison option.\n  //\n  // Option 1:\n  //   int64_t stride_;\n  //   if (ABSL_PREDICT_TRUE(++stride_ < 0)) { ... }\n  //\n  //   GCC   x64 (OK) : https://gcc.godbolt.org/z/R5MzzA\n  //   GCC   ppc (OK) : https://gcc.godbolt.org/z/z7NZAt\n  //   Clang x64 (BAD): https://gcc.godbolt.org/z/t4gPsd\n  //   ICC   x64 (OK) : https://gcc.godbolt.org/z/rE6s8W\n  //   MSVC  x64 (OK) : https://gcc.godbolt.org/z/ARMXqS\n  //\n  // Option 2:\n  //   int64_t stride_ = 0;\n  //   if (ABSL_PREDICT_TRUE(--stride_ >= 0)) { ... }\n  //\n  //   GCC   x64 (OK) : https://gcc.godbolt.org/z/jSQxYK\n  //   GCC   ppc (OK) : https://gcc.godbolt.org/z/VJdYaA\n  //   Clang x64 (BAD): https://gcc.godbolt.org/z/Xm4NjX\n  //   ICC   x64 (OK) : https://gcc.godbolt.org/z/4snaFd\n  //   MSVC  x64 (BAD): https://gcc.godbolt.org/z/BgnEKE\n  //\n  // Option 3:\n  //   uint64_t stride_;\n  //   if (ABSL_PREDICT_TRUE(static_cast<int64_t>(++stride_) < 0)) { ... }\n  //\n  //   GCC   x64 (OK) : https://gcc.godbolt.org/z/bFbfPy\n  //   GCC   ppc (OK) : https://gcc.godbolt.org/z/S9KkUE\n  //   Clang x64 (OK) : https://gcc.godbolt.org/z/UYzRb4\n  //   ICC   x64 (OK) : https://gcc.godbolt.org/z/ptTNfD\n  //   MSVC  x64 (OK) : https://gcc.godbolt.org/z/76j4-5\n  uint64_t stride_ = 0;\n  absl::profiling_internal::ExponentialBiased rng_;\n}\n}\n\n} // extern \"C\"\n",
  "id": "BLOCK-CPP-05825",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/abseil/absl/profiling/internal/periodic_sampler.h",
  "source_line": 88,
  "validation_status": "validated"
}