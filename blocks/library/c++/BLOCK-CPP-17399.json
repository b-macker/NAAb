{
  "code": "{\n\n/// Describes the different kinds of visibility that a declaration\n/// may have.\n///\n/// Visibility determines how a declaration interacts with the dynamic\n/// linker.  It may also affect whether the symbol can be found by runtime\n/// symbol lookup APIs.\n///\n/// Visibility is not described in any language standard and\n/// (nonetheless) sometimes has odd behavior.  Not all platforms\n/// support all visibility kinds.\nenum Visibility {\n  /// Objects with \"hidden\" visibility are not seen by the dynamic\n  /// linker.\n  HiddenVisibility,\n\n  /// Objects with \"protected\" visibility are seen by the dynamic\n  /// linker but always dynamically resolve to an object within this\n  /// shared object.\n  ProtectedVisibility,\n\n  /// Objects with \"default\" visibility are seen by the dynamic linker\n  /// and act like normal objects.\n  DefaultVisibility\n};\n\ninline Visibility minVisibility(Visibility L, Visibility R) {\n  return L < R ? L : R;\n}\n\nclass LinkageInfo {\n  uint8_t linkage_    : 3;\n  uint8_t visibility_ : 2;\n  uint8_t explicit_   : 1;\n\n  void setVisibility(Visibility V, bool E) { visibility_ = V; explicit_ = E; }\npublic:\n  LinkageInfo() : linkage_(ExternalLinkage), visibility_(DefaultVisibility),\n                  explicit_(false) {}\n  LinkageInfo(Linkage L, Visibility V, bool E)\n    : linkage_(L), visibility_(V), explicit_(E) {\n    assert(getLinkage() == L && getVisibility() == V &&\n           isVisibilityExplicit() == E && \"Enum truncated!\");\n  }\n\n  static LinkageInfo external() {\n    return LinkageInfo();\n  }\n  static LinkageInfo internal() {\n    return LinkageInfo(InternalLinkage, DefaultVisibility, false);\n  }\n  static LinkageInfo uniqueExternal() {\n    return LinkageInfo(UniqueExternalLinkage, DefaultVisibility, false);\n  }\n  static LinkageInfo none() {\n    return LinkageInfo(NoLinkage, DefaultVisibility, false);\n  }\n  static LinkageInfo visible_none() {\n    return LinkageInfo(VisibleNoLinkage, DefaultVisibility, false);\n  }\n\n  Linkage getLinkage() const { return (Linkage)linkage_; }\n  Visibility getVisibility() const { return (Visibility)visibility_; }\n  bool isVisibilityExplicit() const { return explicit_; }\n\n  void setLinkage(Linkage L) { linkage_ = L; }\n\n  void mergeLinkage(Linkage L) {\n    setLinkage(minLinkage(getLinkage(), L));\n  }\n  void mergeLinkage(LinkageInfo other) {\n    mergeLinkage(other.getLinkage());\n  }\n\n  void mergeExternalVisibility(Linkage L) {\n    Linkage ThisL = getLinkage();\n    if (!isExternallyVisible(L)) {\n      if (ThisL == VisibleNoLinkage)\n        ThisL = NoLinkage;\n      else if (ThisL == ExternalLinkage)\n        ThisL = UniqueExternalLinkage;\n    }\n    setLinkage(ThisL);\n  }\n  void mergeExternalVisibility(LinkageInfo Other) {\n    mergeExternalVisibility(Other.getLinkage());\n  }\n\n  /// Merge in the visibility 'newVis'.\n  void mergeVisibility(Visibility newVis, bool newExplicit) {\n    Visibility oldVis = getVisibility();\n\n    // Never increase visibility.\n    if (oldVis < newVis)\n      return;\n\n    // If the new visibility is the same as the old and the new\n    // visibility isn't explicit, we have nothing to add.\n    if (oldVis == newVis && !newExplicit)\n      return;\n\n    // Otherwise, we're either decreasing visibility or making our\n    // existing visibility explicit.\n    setVisibility(newVis, newExplicit);\n  }\n  void mergeVisibility(LinkageInfo other) {\n    mergeVisibility(other.getVisibility(), other.isVisibilityExplicit());\n  }\n\n  /// Merge both linkage and visibility.\n  void merge(LinkageInfo other) {\n    mergeLinkage(other);\n    mergeVisibility(other);\n  }\n\n  /// Merge linkage and conditionally merge visibility.\n  void mergeMaybeWithVisibility(LinkageInfo other, bool withVis) {\n    mergeLinkage(other);\n    if (withVis) mergeVisibility(other);\n  }\n};\n}",
  "id": "BLOCK-CPP-17399",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/llvm/clang/include/clang/Basic/Visibility.h",
  "source_line": 21,
  "validation_status": "validated"
}