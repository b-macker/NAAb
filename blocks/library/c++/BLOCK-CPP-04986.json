{
  "code": "{\n\n// If Pair is a standard-layout type, OffsetOf<Pair>::kFirst and\n// OffsetOf<Pair>::kSecond are equivalent to offsetof(Pair, first) and\n// offsetof(Pair, second) respectively. Otherwise they are -1.\n//\n// The purpose of OffsetOf is to avoid calling offsetof() on non-standard-layout\n// type, which is non-portable.\ntemplate <class Pair, class = std::true_type>\nstruct OffsetOf {\n  static constexpr size_t kFirst = static_cast<size_t>(-1);\n  static constexpr size_t kSecond = static_cast<size_t>(-1);\n};\n\ntemplate <class Pair>\nstruct OffsetOf<Pair, typename std::is_standard_layout<Pair>::type> {\n  static constexpr size_t kFirst = offsetof(Pair, first);\n  static constexpr size_t kSecond = offsetof(Pair, second);\n};\n\ntemplate <class K, class V>\nstruct IsLayoutCompatible {\n private:\n  struct Pair {\n    K first;\n    V second;\n  };\n\n  // Is P layout-compatible with Pair?\n  template <class P>\n  static constexpr bool LayoutCompatible() {\n    return std::is_standard_layout<P>() && sizeof(P) == sizeof(Pair) &&\n           alignof(P) == alignof(Pair) &&\n           memory_internal::OffsetOf<P>::kFirst ==\n               memory_internal::OffsetOf<Pair>::kFirst &&\n           memory_internal::OffsetOf<P>::kSecond ==\n               memory_internal::OffsetOf<Pair>::kSecond;\n  }\n\n public:\n  // Whether pair<const K, V> and pair<K, V> are layout-compatible. If they are,\n  // then it is safe to store them in a union and read from either.\n  static constexpr bool value = std::is_standard_layout<K>() &&\n                                std::is_standard_layout<Pair>() &&\n                                memory_internal::OffsetOf<Pair>::kFirst == 0 &&\n                                LayoutCompatible<std::pair<K, V>>() &&\n                                LayoutCompatible<std::pair<const K, V>>();\n};\n\n}",
  "id": "BLOCK-CPP-04986",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/abseil/absl/container/internal/container_memory.h",
  "source_line": 252,
  "validation_status": "validated"
}