{
  "code": "{\n\ntemplate <typename Mutex>\nclass dist_sink : public base_sink<Mutex> {\npublic:\n    dist_sink() = default;\n    explicit dist_sink(std::vector<std::shared_ptr<sink>> sinks)\n        : sinks_(sinks) {}\n\n    dist_sink(const dist_sink &) = delete;\n    dist_sink &operator=(const dist_sink &) = delete;\n\n    void add_sink(std::shared_ptr<sink> sub_sink) {\n        std::lock_guard<Mutex> lock(base_sink<Mutex>::mutex_);\n        sinks_.push_back(sub_sink);\n    }\n\n    void remove_sink(std::shared_ptr<sink> sub_sink) {\n        std::lock_guard<Mutex> lock(base_sink<Mutex>::mutex_);\n        sinks_.erase(std::remove(sinks_.begin(), sinks_.end(), sub_sink), sinks_.end());\n    }\n\n    void set_sinks(std::vector<std::shared_ptr<sink>> sinks) {\n        std::lock_guard<Mutex> lock(base_sink<Mutex>::mutex_);\n        sinks_ = std::move(sinks);\n    }\n\n    std::vector<std::shared_ptr<sink>> &sinks() { return sinks_; }\n\nprotected:\n    void sink_it_(const details::log_msg &msg) override {\n        for (auto &sub_sink : sinks_) {\n            if (sub_sink->should_log(msg.level)) {\n                sub_sink->log(msg);\n            }\n        }\n    }\n\n    void flush_() override {\n        for (auto &sub_sink : sinks_) {\n            sub_sink->flush();\n        }\n    }\n\n    void set_pattern_(const std::string &pattern) override {\n        set_formatter_(details::make_unique<spdlog::pattern_formatter>(pattern));\n    }\n\n    void set_formatter_(std::unique_ptr<spdlog::formatter> sink_formatter) override {\n        base_sink<Mutex>::formatter_ = std::move(sink_formatter);\n        for (auto &sub_sink : sinks_) {\n            sub_sink->set_formatter(base_sink<Mutex>::formatter_->clone());\n        }\n    }\n    std::vector<std::shared_ptr<sink>> sinks_;\n};\n\nusing dist_sink_mt = dist_sink<std::mutex>;\nusing dist_sink_st = dist_sink<details::null_mutex>;\n\n}",
  "id": "BLOCK-CPP-00400",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/spdlog/include/spdlog/sinks/dist_sink.h",
  "source_line": 20,
  "validation_status": "validated"
}