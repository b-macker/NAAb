{
  "code": "#include <string>\n#include <utility>\n#include <vector>\n#include \"absl/base/attributes.h\"\n#include \"absl/base/nullability.h\"\n#include \"absl/strings/string_view.h\"\n\nusing namespace absl;\nusing namespace strings_internal;\n\nextern \"C\" {\n\nvoid BLOCK-CPP-04184_execute() {\n    {\n\nstruct ViableSubstitution {\n  absl::string_view old;\n  absl::string_view replacement;\n  size_t offset;\n\n  ViableSubstitution(absl::string_view old_str,\n                     absl::string_view replacement_str, size_t offset_val)\n      : old(old_str), replacement(replacement_str), offset(offset_val) {}\n\n  // One substitution occurs \"before\" another (takes priority) if either\n  // it has the lowest offset, or it has the same offset but a larger size.\n  bool OccursBefore(const ViableSubstitution& y) const {\n    if (offset != y.offset) return offset < y.offset;\n    return old.size() > y.old.size();\n  }\n};\n\n// Build a vector of ViableSubstitutions based on the given list of\n// replacements. subs can be implemented as a priority_queue. However, it turns\n// out that most callers have small enough a list of substitutions that the\n// overhead of such a queue isn't worth it.\ntemplate <typename StrToStrMapping>\nstd::vector<ViableSubstitution> FindSubstitutions(\n    absl::string_view s, const StrToStrMapping& replacements) {\n  std::vector<ViableSubstitution> subs;\n  subs.reserve(replacements.size());\n\n  for (const auto& rep : replacements) {\n    using std::get;\n    absl::string_view old(get<0>(rep));\n\n    size_t pos = s.find(old);\n    if (pos == s.npos) continue;\n\n    // Ignore attempts to replace \"\". This condition is almost never true,\n    // but above condition is frequently true. That's why we test for this\n    // now and not before.\n    if (old.empty()) continue;\n\n    subs.emplace_back(old, get<1>(rep), pos);\n\n    // Insertion sort to ensure the last ViableSubstitution comes before\n    // all the others.\n    size_t index = subs.size();\n    while (--index && subs[index - 1].OccursBefore(subs[index])) {\n      std::swap(subs[index], subs[index - 1]);\n    }\n  }\n  return subs;\n}\n\nint ApplySubstitutions(absl::string_view s,\n                       absl::Nonnull<std::vector<ViableSubstitution>*> subs_ptr,\n                       absl::Nonnull<std::string*> result_ptr);\n\n}\n}\n\n} // extern \"C\"\n",
  "id": "BLOCK-CPP-04184",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/abseil/absl/strings/str_replace.h",
  "source_line": 136,
  "validation_status": "validated"
}