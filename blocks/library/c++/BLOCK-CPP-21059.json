{
  "code": "{\n\nclass ASTConsumer;\nclass CompilerInstance;\n\nstruct PCHBuffer {\n  ASTFileSignature Signature;\n  llvm::SmallVector<char, 0> Data;\n  bool IsComplete;\n};\n\n/// This abstract interface provides operations for creating\n/// containers for serialized ASTs (precompiled headers and clang\n/// modules).\nclass PCHContainerWriter {\npublic:\n  virtual ~PCHContainerWriter() = 0;\n  virtual llvm::StringRef getFormat() const = 0;\n\n  /// Return an ASTConsumer that can be chained with a\n  /// PCHGenerator that produces a wrapper file format containing a\n  /// serialized AST bitstream.\n  virtual std::unique_ptr<ASTConsumer>\n  CreatePCHContainerGenerator(CompilerInstance &CI,\n                              const std::string &MainFileName,\n                              const std::string &OutputFileName,\n                              std::unique_ptr<llvm::raw_pwrite_stream> OS,\n                              std::shared_ptr<PCHBuffer> Buffer) const = 0;\n};\n\n/// This abstract interface provides operations for unwrapping\n/// containers for serialized ASTs (precompiled headers and clang\n/// modules).\nclass PCHContainerReader {\npublic:\n  virtual ~PCHContainerReader() = 0;\n  /// Equivalent to the format passed to -fmodule-format=\n  virtual llvm::ArrayRef<llvm::StringRef> getFormats() const = 0;\n\n  /// Returns the serialized AST inside the PCH container Buffer.\n  virtual llvm::StringRef ExtractPCH(llvm::MemoryBufferRef Buffer) const = 0;\n};\n\n/// Implements write operations for a raw pass-through PCH container.\nclass RawPCHContainerWriter : public PCHContainerWriter {\n  llvm::StringRef getFormat() const override { return \"raw\"; }\n\n  /// Return an ASTConsumer that can be chained with a\n  /// PCHGenerator that writes the module to a flat file.\n  std::unique_ptr<ASTConsumer>\n  CreatePCHContainerGenerator(CompilerInstance &CI,\n                              const std::string &MainFileName,\n                              const std::string &OutputFileName,\n                              std::unique_ptr<llvm::raw_pwrite_stream> OS,\n                              std::shared_ptr<PCHBuffer> Buffer) const override;\n};\n\n/// Implements read operations for a raw pass-through PCH container.\nclass RawPCHContainerReader : public PCHContainerReader {\n  llvm::ArrayRef<llvm::StringRef> getFormats() const override;\n  /// Simply returns the buffer contained in Buffer.\n  llvm::StringRef ExtractPCH(llvm::MemoryBufferRef Buffer) const override;\n};\n\n/// A registry of PCHContainerWriter and -Reader objects for different formats.\nclass PCHContainerOperations {\n  llvm::StringMap<std::unique_ptr<PCHContainerWriter>> Writers;\n  llvm::StringMap<PCHContainerReader *> Readers;\n  llvm::SmallVector<std::unique_ptr<PCHContainerReader>> OwnedReaders;\n\npublic:\n  /// Automatically registers a RawPCHContainerWriter and\n  /// RawPCHContainerReader.\n  PCHContainerOperations();\n  void registerWriter(std::unique_ptr<PCHContainerWriter> Writer) {\n    Writers[Writer->getFormat()] = std::move(Writer);\n  }\n  void registerReader(std::unique_ptr<PCHContainerReader> Reader) {\n    assert(!Reader->getFormats().empty() &&\n           \"PCHContainerReader must handle >=1 format\");\n    for (llvm::StringRef Fmt : Reader->getFormats())\n      Readers[Fmt] = Reader.get();\n    OwnedReaders.push_back(std::move(Reader));\n  }\n  const PCHContainerWriter *getWriterOrNull(llvm::StringRef Format) {\n    return Writers[Format].get();\n  }\n  const PCHContainerReader *getReaderOrNull(llvm::StringRef Format) {\n    return Readers[Format];\n  }\n  const PCHContainerReader &getRawReader() {\n    return *getReaderOrNull(\"raw\");\n  }\n};\n\n}",
  "id": "BLOCK-CPP-21059",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/llvm/clang/include/clang/Serialization/PCHContainerOperations.h",
  "source_line": 22,
  "validation_status": "validated"
}