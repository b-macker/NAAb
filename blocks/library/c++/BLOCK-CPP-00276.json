{
  "code": "    #include <spdlog/details/os.h>\n#include <spdlog/common.h>\n#include <algorithm>\n#include <array>\n#include <chrono>\n#include <cstdio>\n#include <cstdlib>\n#include <cstring>\n#include <ctime>\n#include <string>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <thread>\n    #include <spdlog/details/windows_include.h>\n    #include <fileapi.h>  // for FlushFileBuffers\n    #include <io.h>       // for _get_osfhandle, _isatty, _fileno\n    #include <process.h>  // for _get_pid\n        #include <share.h>\n        #include <cassert>\n        #include <limits>\n    #include <direct.h>  // for _mkdir/_wmkdir\n    #include <fcntl.h>\n    #include <unistd.h>\n        #include <sys/syscall.h>  //Use gettid() syscall under linux to get thread id\n        #include <pthread.h>  // for pthread_getthrds_np\n        #include <pthread_np.h>  // for pthread_getthreadid_np\n        #include <lwp.h>  // for _lwp_self\n        #include <thread.h>  // for thr_self\n    #include <AvailabilityMacros.h>\n\nusing namespace spdlog;\nusing namespace details;\nusing namespace os;\n\nextern \"C\" {\n\nvoid BLOCK-CPP-00276_execute() {\n    {\n    if (wstr.size() > static_cast<size_t>((std::numeric_limits<int>::max)()) / 2 - 1) {\n        throw_spdlog_ex(\"UTF-16 string is too big to be converted to UTF-8\");\n    }\n\n    int wstr_size = static_cast<int>(wstr.size());\n    if (wstr_size == 0) {\n        target.resize(0);\n        return;\n    }\n\n    int result_size = static_cast<int>(target.capacity());\n    if ((wstr_size + 1) * 2 > result_size) {\n        result_size =\n            ::WideCharToMultiByte(CP_UTF8, 0, wstr.data(), wstr_size, NULL, 0, NULL, NULL);\n    }\n\n    if (result_size > 0) {\n        target.resize(result_size);\n        result_size = ::WideCharToMultiByte(CP_UTF8, 0, wstr.data(), wstr_size, target.data(),\n                                            result_size, NULL, NULL);\n\n        if (result_size > 0) {\n            target.resize(result_size);\n            return;\n        }\n    }\n\n    throw_spdlog_ex(\n        fmt_lib::format(\"WideCharToMultiByte failed. Last error: {}\", ::GetLastError()));\n}\n}\n\n} // extern \"C\"\n",
  "id": "BLOCK-CPP-00276",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/spdlog/include/spdlog/details/os-inl.h",
  "source_line": 441,
  "validation_status": "validated"
}