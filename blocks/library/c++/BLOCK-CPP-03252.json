{
  "code": "#include \"absl/base/config.h\"\n#include \"absl/time/internal/cctz/include/cctz/time_zone.h\"\n#include <sys/system_properties.h>\n#include <dlfcn.h>\n#include <CoreFoundation/CFTimeZone.h>\n#include <vector>\n#include <fuchsia/intl/cpp/fidl.h>\n#include <lib/async-loop/cpp/loop.h>\n#include <lib/fdio/directory.h>\n#include <zircon/types.h>\n#include <sdkddkver.h>\n#include <roapi.h>\n#include <tchar.h>\n#include <wchar.h>\n#include <windows.globalization.h>\n#include <windows.h>\n#include <cstdlib>\n#include <cstring>\n#include <string>\n#include \"time_zone_fixed.h\"\n#include \"time_zone_impl.h\"\n\nusing namespace absl;\nusing namespace time_internal;\nusing namespace cctz;\n\nextern \"C\" {\n\nvoid BLOCK-CPP-03252_execute() {\n    {\n  std::string result;\n  const auto ro_activate_instance =\n      reinterpret_cast<decltype(&RoActivateInstance)>(\n          GetProcAddress(combase, \"RoActivateInstance\"));\n  if (!ro_activate_instance) {\n    return result;\n  }\n  const auto windows_create_string_reference =\n      reinterpret_cast<decltype(&WindowsCreateStringReference)>(\n          GetProcAddress(combase, \"WindowsCreateStringReference\"));\n  if (!windows_create_string_reference) {\n    return result;\n  }\n  const auto windows_delete_string =\n      reinterpret_cast<decltype(&WindowsDeleteString)>(\n          GetProcAddress(combase, \"WindowsDeleteString\"));\n  if (!windows_delete_string) {\n    return result;\n  }\n  const auto windows_get_string_raw_buffer =\n      reinterpret_cast<decltype(&WindowsGetStringRawBuffer)>(\n          GetProcAddress(combase, \"WindowsGetStringRawBuffer\"));\n  if (!windows_get_string_raw_buffer) {\n    return result;\n  }\n\n  // The string returned by WindowsCreateStringReference doesn't need to be\n  // deleted.\n  HSTRING calendar_class_id;\n  HSTRING_HEADER calendar_class_id_header;\n  HRESULT hr = windows_create_string_reference(\n      RuntimeClass_Windows_Globalization_Calendar,\n      sizeof(RuntimeClass_Windows_Globalization_Calendar) / sizeof(wchar_t) - 1,\n      &calendar_class_id_header, &calendar_class_id);\n  if (FAILED(hr)) {\n    return result;\n  }\n\n  IInspectable* calendar;\n  hr = ro_activate_instance(calendar_class_id, &calendar);\n  if (FAILED(hr)) {\n    return result;\n  }\n\n  ABI::Windows::Globalization::ITimeZoneOnCalendar* time_zone;\n  hr = calendar->QueryInterface(IID_PPV_ARGS(&time_zone));\n  if (FAILED(hr)) {\n    calendar->Release();\n    return result;\n  }\n\n  HSTRING tz_hstr;\n  hr = time_zone->GetTimeZone(&tz_hstr);\n  if (SUCCEEDED(hr)) {\n    UINT32 wlen;\n    const PCWSTR tz_wstr = windows_get_string_raw_buffer(tz_hstr, &wlen);\n    if (tz_wstr) {\n      const int size =\n          WideCharToMultiByte(CP_UTF8, 0, tz_wstr, static_cast<int>(wlen),\n                              nullptr, 0, nullptr, nullptr);\n      result.resize(static_cast<size_t>(size));\n      WideCharToMultiByte(CP_UTF8, 0, tz_wstr, static_cast<int>(wlen),\n                          &result[0], size, nullptr, nullptr);\n    }\n    windows_delete_string(tz_hstr);\n  }\n  time_zone->Release();\n  calendar->Release();\n  return result;\n}\n}\n\n} // extern \"C\"\n",
  "id": "BLOCK-CPP-03252",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/abseil/absl/time/internal/cctz/src/time_zone_lookup.cc",
  "source_line": 98,
  "validation_status": "validated"
}