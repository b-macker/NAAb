{
  "code": "{\n  static constexpr double kLogSqrtPi =\n      0.5723649429247000870717135;  // Log[Sqrt[Pi]]\n  static constexpr double kInverseSqrtPi =\n      0.5641895835477562869480795;  // 1/(Sqrt[Pi])\n\n  // For large degrees of freedom, use the normal approximation by\n  //     Wilson, E. B. and Hilferty, M. M. (1931)\n  // Via Wikipedia:\n  //   By the Central Limit Theorem, because the chi-square distribution is the\n  //   sum of k independent random variables with finite mean and variance, it\n  //   converges to a normal distribution for large k.\n  if (dof > kLargeDOF) {\n    // Re-scale everything.\n    const double chi_square_scaled = std::pow(chi_square / dof, 1.0 / 3);\n    const double mean = 1 - 2.0 / (9 * dof);\n    const double variance = 2.0 / (9 * dof);\n    // If variance is 0, this method cannot be used.\n    if (variance != 0) {\n      const double z = (chi_square_scaled - mean) / std::sqrt(variance);\n      if (z > 0) {\n        return normal_survival(z);\n      } else if (z < 0) {\n        return 1.0 - normal_survival(-z);\n      } else {\n        return 0.5;\n      }\n    }\n  }\n\n  // The chi square function is >= 0 for any degrees of freedom.\n  // In other words, probability that the chi square function >= 0 is 1.\n  if (chi_square <= 0.0) return 1.0;\n\n  // If the degrees of freedom is zero, the chi square function is always 0 by\n  // definition. In other words, the probability that the chi square function\n  // is > 0 is zero (chi square values <= 0 have been filtered above).\n  if (dof < 1) return 0;\n\n  auto capped_exp = [](double x) { return x < -20 ? 0.0 : std::exp(x); };\n  static constexpr double kBigX = 20;\n\n  double a = 0.5 * chi_square;\n  const bool even = !(dof & 1);  // True if dof is an even number.\n  const double y = capped_exp(-a);\n  double s = even ? y : (2.0 * POZ(-std::sqrt(chi_square)));\n\n  if (dof <= 2) {\n    return s;\n  }\n\n  chi_square = 0.5 * (dof - 1.0);\n  double z = (even ? 1.0 : 0.5);\n  if (a > kBigX) {\n    double e = (even ? 0.0 : kLogSqrtPi);\n    double c = std::log(a);\n    while (z <= chi_square) {\n      e = std::log(z) + e;\n      s += capped_exp(c * z - a - e);\n      z += 1.0;\n    }\n    return s;\n  }\n\n  double e = (even ? 1.0 : (kInverseSqrtPi / std::sqrt(a)));\n  double c = 0.0;\n  while (z <= chi_square) {\n    e = e * (a / z);\n    c = c + e;\n    z += 1.0;\n  }\n  return c * y + s;\n}",
  "id": "BLOCK-CPP-02771",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/abseil/absl/random/internal/chi_square.cc",
  "source_line": 157,
  "validation_status": "validated"
}