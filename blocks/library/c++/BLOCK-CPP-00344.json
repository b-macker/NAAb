{
  "code": "{\nnamespace details {\n\nclass udp_client {\n    static constexpr int TX_BUFFER_SIZE = 1024 * 10;\n    int socket_ = -1;\n    struct sockaddr_in sockAddr_;\n\n    void cleanup_() {\n        if (socket_ != -1) {\n            ::close(socket_);\n            socket_ = -1;\n        }\n    }\n\npublic:\n    udp_client(const std::string &host, uint16_t port) {\n        socket_ = ::socket(PF_INET, SOCK_DGRAM, 0);\n        if (socket_ < 0) {\n            throw_spdlog_ex(\"error: Create Socket Failed!\");\n        }\n\n        int option_value = TX_BUFFER_SIZE;\n        if (::setsockopt(socket_, SOL_SOCKET, SO_SNDBUF,\n                         reinterpret_cast<const char *>(&option_value), sizeof(option_value)) < 0) {\n            cleanup_();\n            throw_spdlog_ex(\"error: setsockopt(SO_SNDBUF) Failed!\");\n        }\n\n        sockAddr_.sin_family = AF_INET;\n        sockAddr_.sin_port = htons(port);\n\n        if (::inet_aton(host.c_str(), &sockAddr_.sin_addr) == 0) {\n            cleanup_();\n            throw_spdlog_ex(\"error: Invalid address!\");\n        }\n\n        ::memset(sockAddr_.sin_zero, 0x00, sizeof(sockAddr_.sin_zero));\n    }\n\n    ~udp_client() { cleanup_(); }\n\n    int fd() const { return socket_; }\n\n    // Send exactly n_bytes of the given data.\n    // On error close the connection and throw.\n    void send(const char *data, size_t n_bytes) {\n        ssize_t toslen = 0;\n        socklen_t tolen = sizeof(struct sockaddr);\n        if ((toslen = ::sendto(socket_, data, n_bytes, 0, (struct sockaddr *)&sockAddr_, tolen)) ==\n            -1) {\n            throw_spdlog_ex(\"sendto(2) failed\", errno);\n        }\n    }\n};\n}  // namespace details\n}",
  "id": "BLOCK-CPP-00344",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/spdlog/include/spdlog/details/udp_client.h",
  "source_line": 25,
  "validation_status": "validated"
}