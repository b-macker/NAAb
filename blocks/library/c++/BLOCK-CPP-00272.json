{
  "code": "    #include <spdlog/details/os.h>\n#include <spdlog/common.h>\n#include <algorithm>\n#include <array>\n#include <chrono>\n#include <cstdio>\n#include <cstdlib>\n#include <cstring>\n#include <ctime>\n#include <string>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <thread>\n    #include <spdlog/details/windows_include.h>\n    #include <fileapi.h>  // for FlushFileBuffers\n    #include <io.h>       // for _get_osfhandle, _isatty, _fileno\n    #include <process.h>  // for _get_pid\n        #include <share.h>\n        #include <cassert>\n        #include <limits>\n    #include <direct.h>  // for _mkdir/_wmkdir\n    #include <fcntl.h>\n    #include <unistd.h>\n        #include <sys/syscall.h>  //Use gettid() syscall under linux to get thread id\n        #include <pthread.h>  // for pthread_getthrds_np\n        #include <pthread_np.h>  // for pthread_getthreadid_np\n        #include <lwp.h>  // for _lwp_self\n        #include <thread.h>  // for thr_self\n    #include <AvailabilityMacros.h>\n\nusing namespace spdlog;\nusing namespace details;\nusing namespace os;\n\nextern \"C\" {\n\nvoid BLOCK-CPP-00272_execute() {\n    {\n#ifdef _WIN32\n    #if _WIN32_WINNT < _WIN32_WINNT_WS08\n    TIME_ZONE_INFORMATION tzinfo;\n    auto rv = ::GetTimeZoneInformation(&tzinfo);\n    #else\n    DYNAMIC_TIME_ZONE_INFORMATION tzinfo;\n    auto rv = ::GetDynamicTimeZoneInformation(&tzinfo);\n    #endif\n    if (rv == TIME_ZONE_ID_INVALID) throw_spdlog_ex(\"Failed getting timezone info. \", errno);\n\n    int offset = -tzinfo.Bias;\n    if (tm.tm_isdst) {\n        offset -= tzinfo.DaylightBias;\n    } else {\n        offset -= tzinfo.StandardBias;\n    }\n    return offset;\n#else\n\n    #if defined(sun) || defined(__sun) || defined(_AIX) || \\\n        (defined(__NEWLIB__) && !defined(__TM_GMTOFF)) ||  \\\n        (!defined(_BSD_SOURCE) && !defined(_GNU_SOURCE))\n    // 'tm_gmtoff' field is BSD extension and it's missing on SunOS/Solaris\n    struct helper {\n        static long int calculate_gmt_offset(const std::tm &localtm = details::os::localtime(),\n                                             const std::tm &gmtm = details::os::gmtime()) {\n            int local_year = localtm.tm_year + (1900 - 1);\n            int gmt_year = gmtm.tm_year + (1900 - 1);\n\n            long int days = (\n                // difference in day of year\n                localtm.tm_yday -\n                gmtm.tm_yday\n\n                // + intervening leap days\n                + ((local_year >> 2) - (gmt_year >> 2)) - (local_year / 100 - gmt_year / 100) +\n                ((local_year / 100 >> 2) - (gmt_year / 100 >> 2))\n\n                // + difference in years * 365 */\n                + static_cast<long int>(local_year - gmt_year) * 365);\n\n            long int hours = (24 * days) + (localtm.tm_hour - gmtm.tm_hour);\n            long int mins = (60 * hours) + (localtm.tm_min - gmtm.tm_min);\n            long int secs = (60 * mins) + (localtm.tm_sec - gmtm.tm_sec);\n\n            return secs;\n        }\n    };\n\n    auto offset_seconds = helper::calculate_gmt_offset(tm);\n    #else\n    auto offset_seconds = tm.tm_gmtoff;\n    #endif\n\n    return static_cast<int>(offset_seconds / 60);\n#endif\n}\n}\n\n} // extern \"C\"\n",
  "id": "BLOCK-CPP-00272",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/spdlog/include/spdlog/details/os-inl.h",
  "source_line": 248,
  "validation_status": "validated"
}