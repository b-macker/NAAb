{
  "code": "#include \"absl/random/internal/pool_urbg.h\"\n#include <algorithm>\n#include <atomic>\n#include <cstdint>\n#include <cstring>\n#include <iterator>\n#include \"absl/base/attributes.h\"\n#include \"absl/base/call_once.h\"\n#include \"absl/base/config.h\"\n#include \"absl/base/internal/endian.h\"\n#include \"absl/base/internal/raw_logging.h\"\n#include \"absl/base/internal/spinlock.h\"\n#include \"absl/base/internal/sysinfo.h\"\n#include \"absl/base/internal/unaligned_access.h\"\n#include \"absl/base/optimization.h\"\n#include \"absl/random/internal/randen.h\"\n#include \"absl/random/internal/seed_material.h\"\n#include \"absl/random/seed_gen_exception.h\"\n\nusing namespace absl;\nusing namespace random_internal;\n\nextern \"C\" {\n\nvoid BLOCK-CPP-02783_execute() {\n    {\n  static_assert(kPoolSize >= 1,\n                \"At least one urbg instance is required for PoolURBG\");\n\n  ABSL_CONST_INIT static std::atomic<uint64_t> sequence{0};\n\n#ifdef ABSL_HAVE_THREAD_LOCAL\n  static thread_local size_t my_pool_id = kPoolSize;\n  if (ABSL_PREDICT_FALSE(my_pool_id == kPoolSize)) {\n    my_pool_id = (sequence++ % kPoolSize);\n  }\n  return my_pool_id;\n#else\n  static pthread_key_t tid_key = [] {\n    pthread_key_t tmp_key;\n    int err = pthread_key_create(&tmp_key, nullptr);\n    if (err) {\n      ABSL_RAW_LOG(FATAL, \"pthread_key_create failed with %d\", err);\n    }\n    return tmp_key;\n  }();\n\n  // Store the value in the pthread_{get/set}specific. However an uninitialized\n  // value is 0, so add +1 to distinguish from the null value.\n  uintptr_t my_pool_id =\n      reinterpret_cast<uintptr_t>(pthread_getspecific(tid_key));\n  if (ABSL_PREDICT_FALSE(my_pool_id == 0)) {\n    // No allocated ID, allocate the next value, cache it, and return.\n    my_pool_id = (sequence++ % kPoolSize) + 1;\n    int err = pthread_setspecific(tid_key, reinterpret_cast<void*>(my_pool_id));\n    if (err) {\n      ABSL_RAW_LOG(FATAL, \"pthread_setspecific failed with %d\", err);\n    }\n  }\n  return my_pool_id - 1;\n#endif\n}\n}\n\n} // extern \"C\"\n",
  "id": "BLOCK-CPP-02783",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/abseil/absl/random/internal/pool_urbg.cc",
  "source_line": 150,
  "validation_status": "validated"
}