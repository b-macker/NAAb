{
  "code": "{\n\n/// The information about the darwin SDK that was used during this compilation.\nclass DarwinSDKInfo {\npublic:\n  /// A value that describes two os-environment pairs that can be used as a key\n  /// to the version map in the SDK.\n  struct OSEnvPair {\n  public:\n    using StorageType = uint64_t;\n\n    constexpr OSEnvPair(llvm::Triple::OSType FromOS,\n                        llvm::Triple::EnvironmentType FromEnv,\n                        llvm::Triple::OSType ToOS,\n                        llvm::Triple::EnvironmentType ToEnv)\n        : Value(((StorageType(FromOS) * StorageType(llvm::Triple::LastOSType) +\n                  StorageType(FromEnv))\n                 << 32ull) |\n                (StorageType(ToOS) * StorageType(llvm::Triple::LastOSType) +\n                 StorageType(ToEnv))) {}\n\n    /// Returns the os-environment mapping pair that's used to represent the\n    /// macOS -> Mac Catalyst version mapping.\n    static inline constexpr OSEnvPair macOStoMacCatalystPair() {\n      return OSEnvPair(llvm::Triple::MacOSX, llvm::Triple::UnknownEnvironment,\n                       llvm::Triple::IOS, llvm::Triple::MacABI);\n    }\n\n    /// Returns the os-environment mapping pair that's used to represent the\n    /// Mac Catalyst -> macOS version mapping.\n    static inline constexpr OSEnvPair macCatalystToMacOSPair() {\n      return OSEnvPair(llvm::Triple::IOS, llvm::Triple::MacABI,\n                       llvm::Triple::MacOSX, llvm::Triple::UnknownEnvironment);\n    }\n\n    /// Returns the os-environment mapping pair that's used to represent the\n    /// iOS -> watchOS version mapping.\n    static inline constexpr OSEnvPair iOStoWatchOSPair() {\n      return OSEnvPair(llvm::Triple::IOS, llvm::Triple::UnknownEnvironment,\n                       llvm::Triple::WatchOS, llvm::Triple::UnknownEnvironment);\n    }\n\n    /// Returns the os-environment mapping pair that's used to represent the\n    /// iOS -> tvOS version mapping.\n    static inline constexpr OSEnvPair iOStoTvOSPair() {\n      return OSEnvPair(llvm::Triple::IOS, llvm::Triple::UnknownEnvironment,\n                       llvm::Triple::TvOS, llvm::Triple::UnknownEnvironment);\n    }\n\n  private:\n    StorageType Value;\n\n    friend class DarwinSDKInfo;\n  };\n\n  /// Represents a version mapping that maps from a version of one target to a\n  /// version of a related target.\n  ///\n  /// e.g. \"macOS_iOSMac\":{\"10.15\":\"13.1\"} is an example of a macOS -> Mac\n  /// Catalyst version map.\n  class RelatedTargetVersionMapping {\n  public:\n    RelatedTargetVersionMapping(\n        VersionTuple MinimumKeyVersion, VersionTuple MaximumKeyVersion,\n        VersionTuple MinimumValue, VersionTuple MaximumValue,\n        llvm::DenseMap<VersionTuple, VersionTuple> Mapping)\n        : MinimumKeyVersion(MinimumKeyVersion),\n          MaximumKeyVersion(MaximumKeyVersion), MinimumValue(MinimumValue),\n          MaximumValue(MaximumValue), Mapping(Mapping) {\n      assert(!this->Mapping.empty() && \"unexpected empty mapping\");\n    }\n\n    /// Returns the value with the lowest version in the mapping.\n    const VersionTuple &getMinimumValue() const { return MinimumValue; }\n\n    /// Returns the mapped key, or the appropriate Minimum / MaximumValue if\n    /// they key is outside of the mapping bounds. If they key isn't mapped, but\n    /// within the minimum and maximum bounds, std::nullopt is returned.\n    std::optional<VersionTuple>\n    map(const VersionTuple &Key, const VersionTuple &MinimumValue,\n        std::optional<VersionTuple> MaximumValue) const;\n\n    static std::optional<RelatedTargetVersionMapping>\n    parseJSON(const llvm::json::Object &Obj,\n              VersionTuple MaximumDeploymentTarget);\n\n  private:\n    VersionTuple MinimumKeyVersion;\n    VersionTuple MaximumKeyVersion;\n    VersionTuple MinimumValue;\n    VersionTuple MaximumValue;\n    llvm::DenseMap<VersionTuple, VersionTuple> Mapping;\n  };\n\n  DarwinSDKInfo(\n      VersionTuple Version, VersionTuple MaximumDeploymentTarget,\n      llvm::DenseMap<OSEnvPair::StorageType,\n                     std::optional<RelatedTargetVersionMapping>>\n          VersionMappings =\n              llvm::DenseMap<OSEnvPair::StorageType,\n                             std::optional<RelatedTargetVersionMapping>>())\n      : Version(Version), MaximumDeploymentTarget(MaximumDeploymentTarget),\n        VersionMappings(std::move(VersionMappings)) {}\n\n  const llvm::VersionTuple &getVersion() const { return Version; }\n\n  // Returns the optional, target-specific version mapping that maps from one\n  // target to another target.\n  //\n  // This mapping is constructed from an appropriate mapping in the SDKSettings,\n  // for instance, when building for Mac Catalyst, the mapping would contain the\n  // \"macOS_iOSMac\" mapping as it maps the macOS versions to the Mac Catalyst\n  // versions.\n  //\n  // This mapping does not exist when the target doesn't have an appropriate\n  // related version mapping, or when there was an error reading the mapping\n  // from the SDKSettings, or when it's missing in the SDKSettings.\n  const RelatedTargetVersionMapping *getVersionMapping(OSEnvPair Kind) const {\n    auto Mapping = VersionMappings.find(Kind.Value);\n    if (Mapping == VersionMappings.end())\n      return nullptr;\n    return Mapping->getSecond() ? &*Mapping->getSecond() : nullptr;\n  }\n\n  static std::optional<DarwinSDKInfo>\n  parseDarwinSDKSettingsJSON(const llvm::json::Object *Obj);\n\nprivate:\n  VersionTuple Version;\n  VersionTuple MaximumDeploymentTarget;\n  // Need to wrap the value in an optional here as the value has to be default\n  // constructible, and std::unique_ptr doesn't like DarwinSDKInfo being\n  // Optional as Optional is trying to copy it in emplace.\n  llvm::DenseMap<OSEnvPair::StorageType,\n                 std::optional<RelatedTargetVersionMapping>>\n      VersionMappings;\n};\n\n/// Parse the SDK information from the SDKSettings.json file.\n///\n/// \\returns an error if the SDKSettings.json file is invalid, std::nullopt if\n/// the SDK has no SDKSettings.json, or a valid \\c DarwinSDKInfo otherwise.\nExpected<std::optional<DarwinSDKInfo>>\nparseDarwinSDKInfo(llvm::vfs::FileSystem &VFS, StringRef SDKRootPath);\n\n}",
  "id": "BLOCK-CPP-16116",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/llvm/clang/include/clang/Basic/DarwinSDKInfo.h",
  "source_line": 26,
  "validation_status": "validated"
}