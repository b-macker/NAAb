{
  "code": "{\n/// A worklist implementation where the enqueued blocks will be dequeued based\n/// on the order defined by 'Comp'.\ntemplate <typename Comp, unsigned QueueSize> class DataflowWorklistBase {\n  llvm::BitVector EnqueuedBlocks;\n  PostOrderCFGView *POV;\n  llvm::PriorityQueue<const CFGBlock *,\n                      SmallVector<const CFGBlock *, QueueSize>, Comp>\n      WorkList;\n\npublic:\n  DataflowWorklistBase(const CFG &Cfg, PostOrderCFGView *POV, Comp C)\n      : EnqueuedBlocks(Cfg.getNumBlockIDs()), POV(POV), WorkList(C) {}\n\n  const PostOrderCFGView *getCFGView() const { return POV; }\n\n  void enqueueBlock(const CFGBlock *Block) {\n    if (Block && !EnqueuedBlocks[Block->getBlockID()]) {\n      EnqueuedBlocks[Block->getBlockID()] = true;\n      WorkList.push(Block);\n    }\n  }\n\n  const CFGBlock *dequeue() {\n    if (WorkList.empty())\n      return nullptr;\n    const CFGBlock *B = WorkList.top();\n    WorkList.pop();\n    EnqueuedBlocks[B->getBlockID()] = false;\n    return B;\n  }\n};\n\nstruct ReversePostOrderCompare {\n  PostOrderCFGView::BlockOrderCompare Cmp;\n  bool operator()(const CFGBlock *lhs, const CFGBlock *rhs) const {\n    return Cmp(rhs, lhs);\n  }\n};\n\n/// A worklist implementation for forward dataflow analysis. The enqueued\n/// blocks will be dequeued in reverse post order. The worklist cannot contain\n/// the same block multiple times at once.\nstruct ForwardDataflowWorklist\n    : DataflowWorklistBase<ReversePostOrderCompare, 20> {\n  ForwardDataflowWorklist(const CFG &Cfg, PostOrderCFGView *POV)\n      : DataflowWorklistBase(Cfg, POV,\n                             ReversePostOrderCompare{POV->getComparator()}) {}\n\n  ForwardDataflowWorklist(const CFG &Cfg, AnalysisDeclContext &Ctx)\n      : ForwardDataflowWorklist(Cfg, Ctx.getAnalysis<PostOrderCFGView>()) {}\n\n  void enqueueSuccessors(const CFGBlock *Block) {\n    for (auto B : Block->succs())\n      enqueueBlock(B);\n  }\n};\n\n/// A worklist implementation for backward dataflow analysis. The enqueued\n/// block will be dequeued in post order. The worklist cannot contain the same\n/// block multiple times at once.\nstruct BackwardDataflowWorklist\n    : DataflowWorklistBase<PostOrderCFGView::BlockOrderCompare, 20> {\n  BackwardDataflowWorklist(const CFG &Cfg, AnalysisDeclContext &Ctx)\n      : DataflowWorklistBase(\n            Cfg, Ctx.getAnalysis<PostOrderCFGView>(),\n            Ctx.getAnalysis<PostOrderCFGView>()->getComparator()) {}\n\n  void enqueuePredecessors(const CFGBlock *Block) {\n    for (auto B : Block->preds())\n      enqueueBlock(B);\n  }\n};\n\n}",
  "id": "BLOCK-CPP-21932",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/llvm/clang/include/clang/Analysis/FlowSensitive/DataflowWorklist.h",
  "source_line": 19,
  "validation_status": "validated"
}