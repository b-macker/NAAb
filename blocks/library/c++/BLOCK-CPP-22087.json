{
  "code": "{\n\n// FIXME: Explore using an allowlist-approach, where constructs supported by the\n// analysis are always enabled and additional constructs are enabled through the\n// `Options`.\nstruct UncheckedOptionalAccessModelOptions {\n  /// In generating diagnostics, ignore optionals reachable through overloaded\n  /// `operator*` or `operator->` (other than those of the optional type\n  /// itself). The analysis does not equate the results of such calls, so it\n  /// can't identify when their results are used safely (across calls),\n  /// resulting in false positives in all such cases. Note: this option does not\n  /// cover access through `operator[]`.\n  bool IgnoreSmartPointerDereference = false;\n};\n\n/// Dataflow analysis that models whether optionals hold values or not.\n///\n/// Models the `std::optional`, `absl::optional`, and `base::Optional` types.\nclass UncheckedOptionalAccessModel\n    : public DataflowAnalysis<UncheckedOptionalAccessModel, NoopLattice> {\npublic:\n  UncheckedOptionalAccessModel(ASTContext &Ctx);\n\n  /// Returns a matcher for the optional classes covered by this model.\n  static ast_matchers::DeclarationMatcher optionalClassDecl();\n\n  static NoopLattice initialElement() { return {}; }\n\n  void transfer(const CFGElement &Elt, NoopLattice &L, Environment &Env);\n\n  ComparisonResult compare(QualType Type, const Value &Val1,\n                           const Environment &Env1, const Value &Val2,\n                           const Environment &Env2) override;\n\n  bool merge(QualType Type, const Value &Val1, const Environment &Env1,\n             const Value &Val2, const Environment &Env2, Value &MergedVal,\n             Environment &MergedEnv) override;\n\n  Value *widen(QualType Type, Value &Prev, const Environment &PrevEnv,\n               Value &Current, Environment &CurrentEnv) override;\n\nprivate:\n  CFGMatchSwitch<TransferState<NoopLattice>> TransferMatchSwitch;\n};\n\nclass UncheckedOptionalAccessDiagnoser {\npublic:\n  UncheckedOptionalAccessDiagnoser(\n      UncheckedOptionalAccessModelOptions Options = {});\n\n  std::vector<SourceLocation> diagnose(ASTContext &Ctx, const CFGElement *Elt,\n                                       const Environment &Env);\n\nprivate:\n  CFGMatchSwitch<const Environment, std::vector<SourceLocation>>\n      DiagnoseMatchSwitch;\n};\n\n}",
  "id": "BLOCK-CPP-22087",
  "language": "c++",
  "source_file": "/storage/emulated/0/Download/cpp_codebases/llvm/clang/include/clang/Analysis/FlowSensitive/Models/UncheckedOptionalAccessModel.h",
  "source_line": 27,
  "validation_status": "validated"
}