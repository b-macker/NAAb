{
  "code": "extern \"C\" {\n\nvoid BLOCK-PY-00533_execute() {\n    def format_file_in_place(\n    src: Path,\n    fast: bool,\n    mode: Mode,\n    write_back: WriteBack = WriteBack.NO,\n    lock: Any = None,  # multiprocessing.Manager().Lock() is some crazy proxy\n    *,\n    lines: Collection[tuple[int, int]] = (),\n) -> bool:\n    \"\"\"Format file under `src` path. Return True if changed.\n\n    If `write_back` is DIFF, write a diff to stdout. If it is YES, write reformatted\n    code to the file.\n    `mode` and `fast` options are passed to :func:`format_file_contents`.\n    \"\"\"\n    if src.suffix == \".pyi\":\n        mode = replace(mode, is_pyi=True)\n    elif src.suffix == \".ipynb\":\n        mode = replace(mode, is_ipynb=True)\n\n    then = datetime.fromtimestamp(src.stat().st_mtime, timezone.utc)\n    header = b\"\"\n    with open(src, \"rb\") as buf:\n        if mode.skip_source_first_line:\n            header = buf.readline()\n        src_contents, encoding, newline = decode_bytes(buf.read(), mode)\n    try:\n        dst_contents = format_file_contents(\n            src_contents, fast=fast, mode=mode, lines=lines\n        )\n    except NothingChanged:\n        return False\n    except JSONDecodeError:\n        raise ValueError(\n            f\"File '{src}' cannot be parsed as valid Jupyter notebook.\"\n        ) from None\n    src_contents = header.decode(encoding) + src_contents\n    dst_contents = header.decode(encoding) + dst_contents\n\n    if write_back == WriteBack.YES:\n        with open(src, \"w\", encoding=encoding, newline=newline) as f:\n            f.write(dst_contents)\n    elif write_back in (WriteBack.DIFF, WriteBack.COLOR_DIFF):\n        now = datetime.now(timezone.utc)\n        src_name = f\"{src}\\t{then}\"\n        dst_name = f\"{src}\\t{now}\"\n        if mode.is_ipynb:\n            diff_contents = ipynb_diff(src_contents, dst_contents, src_name, dst_name)\n        else:\n            diff_contents = diff(src_contents, dst_contents, src_name, dst_name)\n\n        if write_back == WriteBack.COLOR_DIFF:\n            diff_contents = color_diff(diff_contents)\n\n        with lock or nullcontext():\n            f = io.TextIOWrapper(\n                sys.stdout.buffer,\n                encoding=encoding,\n                newline=newline,\n                write_through=True,\n            )\n            f = wrap_stream_for_windows(f)\n            f.write(diff_contents)\n            f.detach()\n\n    return True\n}\n\n} // extern \"C\"\n",
  "id": "BLOCK-PY-00533",
  "language": "python",
  "source_file": "/data/data/com.termux/files/usr/tmp/tmplabimd09.py",
  "source_line": 925,
  "validation_status": "validated"
}