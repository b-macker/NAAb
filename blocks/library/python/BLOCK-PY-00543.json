{
  "code": "extern \"C\" {\n\nvoid BLOCK-PY-00543_execute() {\n    def get_features_used(\n    node: Node, *, future_imports: set[str] | None = None\n) -> set[Feature]:\n    \"\"\"Return a set of (relatively) new Python features used in this file.\n\n    Currently looking for:\n    - f-strings;\n    - self-documenting expressions in f-strings (f\"{x=}\");\n    - underscores in numeric literals;\n    - trailing commas after * or ** in function signatures and calls;\n    - positional only arguments in function signatures and lambdas;\n    - assignment expression;\n    - relaxed decorator syntax;\n    - usage of __future__ flags (annotations);\n    - print / exec statements;\n    - parenthesized context managers;\n    - match statements;\n    - except* clause;\n    - variadic generics;\n    \"\"\"\n    features: set[Feature] = set()\n    if future_imports:\n        features |= {\n            FUTURE_FLAG_TO_FEATURE[future_import]\n            for future_import in future_imports\n            if future_import in FUTURE_FLAG_TO_FEATURE\n        }\n\n    for n in node.pre_order():\n        if n.type == token.FSTRING_START:\n            features.add(Feature.F_STRINGS)\n        elif n.type == token.TSTRING_START:\n            features.add(Feature.T_STRINGS)\n        elif (\n            n.type == token.RBRACE\n            and n.parent is not None\n            and any(child.type == token.EQUAL for child in n.parent.children)\n        ):\n            features.add(Feature.DEBUG_F_STRINGS)\n\n        elif is_number_token(n):\n            if \"_\" in n.value:\n                features.add(Feature.NUMERIC_UNDERSCORES)\n\n        elif n.type == token.SLASH:\n            if n.parent and n.parent.type in {\n                syms.typedargslist,\n                syms.arglist,\n                syms.varargslist,\n            }:\n                features.add(Feature.POS_ONLY_ARGUMENTS)\n\n        elif n.type == token.COLONEQUAL:\n            features.add(Feature.ASSIGNMENT_EXPRESSIONS)\n\n        elif n.type == syms.decorator:\n            if len(n.children) > 1 and not is_simple_decorator_expression(\n                n.children[1]\n            ):\n                features.add(Feature.RELAXED_DECORATORS)\n\n        elif (\n            n.type in {syms.typedargslist, syms.arglist}\n            and n.children\n            and n.children[-1].type == token.COMMA\n        ):\n            if n.type == syms.typedargslist:\n                feature = Feature.TRAILING_COMMA_IN_DEF\n            else:\n                feature = Feature.TRAILING_COMMA_IN_CALL\n\n            for ch in n.children:\n                if ch.type in STARS:\n                    features.add(feature)\n\n                if ch.type == syms.argument:\n                    for argch in ch.children:\n                        if argch.type in STARS:\n                            features.add(feature)\n\n        elif (\n            n.type in {syms.return_stmt, syms.yield_expr}\n            and len(n.children) >= 2\n            and n.children[1].type == syms.testlist_star_expr\n            and any(child.type == syms.star_expr for child in n.children[1].children)\n        ):\n            features.add(Feature.UNPACKING_ON_FLOW)\n\n        elif (\n            n.type == syms.annassign\n            and len(n.children) >= 4\n            and n.children[3].type == syms.testlist_star_expr\n        ):\n            features.add(Feature.ANN_ASSIGN_EXTENDED_RHS)\n\n        elif (\n            n.type == syms.with_stmt\n            and len(n.children) > 2\n            and n.children[1].type == syms.atom\n        ):\n            atom_children = n.children[1].children\n            if (\n                len(atom_children) == 3\n                and atom_children[0].type == token.LPAR\n                and _contains_asexpr(atom_children[1])\n                and atom_children[2].type == token.RPAR\n            ):\n                features.add(Feature.PARENTHESIZED_CONTEXT_MANAGERS)\n\n        elif n.type == syms.match_stmt:\n            features.add(Feature.PATTERN_MATCHING)\n\n        elif n.type in {syms.subscriptlist, syms.trailer} and any(\n            child.type == syms.star_expr for child in n.children\n        ):\n            features.add(Feature.VARIADIC_GENERICS)\n\n        elif (\n            n.type == syms.tname_star\n            and len(n.children) == 3\n            and n.children[2].type == syms.star_expr\n        ):\n            features.add(Feature.VARIADIC_GENERICS)\n\n        elif n.type in (syms.type_stmt, syms.typeparams):\n            features.add(Feature.TYPE_PARAMS)\n\n        elif (\n            n.type in (syms.typevartuple, syms.paramspec, syms.typevar)\n            and n.children[-2].type == token.EQUAL\n        ):\n            features.add(Feature.TYPE_PARAM_DEFAULTS)\n\n        elif (\n            n.type == syms.except_clause\n            and len(n.children) >= 2\n            and (\n                n.children[1].type == token.STAR or n.children[1].type == syms.testlist\n            )\n        ):\n            is_star_except = n.children[1].type == token.STAR\n\n            if is_star_except:\n                features.add(Feature.EXCEPT_STAR)\n\n            # Presence of except* pushes as clause 1 index back\n            has_as_clause = (\n                len(n.children) >= is_star_except + 3\n                and n.children[is_star_except + 2].type == token.NAME\n                and n.children[is_star_except + 2].value == \"as\"  # type: ignore\n            )\n\n            # If there's no 'as' clause and the except expression is a testlist.\n            if not has_as_clause and (\n                (is_star_except and n.children[2].type == syms.testlist)\n                or (not is_star_except and n.children[1].type == syms.testlist)\n            ):\n                features.add(Feature.UNPARENTHESIZED_EXCEPT_TYPES)\n\n    return features\n}\n\n} // extern \"C\"\n",
  "id": "BLOCK-PY-00543",
  "language": "python",
  "source_file": "/data/data/com.termux/files/usr/tmp/tmplabimd09.py",
  "source_line": 1336,
  "validation_status": "validated"
}