{
  "id": "BLOCK-PY-00558",
  "version": "1.0",
  "name": "_generate_django_application",
  "language": "python",
  "category": "web_framework",
  "subcategory": null,
  "code": "def _generate_django_application(self, request) -> str:\n        \"\"\"Generate Django application with modern patterns\"\"\"\n        return '''\n# Django Enterprise Application with Modern Patterns\n# models.py\nfrom django.db import models\nfrom django.contrib.auth.models import AbstractUser\nfrom django.core.validators import EmailValidator\nfrom django.utils import timezone\nfrom django.urls import reverse\nfrom django.core.cache import cache\nimport uuid\n\nclass TimestampedModel(models.Model):\n    \"\"\"Abstract base model with timestamp fields\"\"\"\n    created_at = models.DateTimeField(auto_now_add=True)\n    updated_at = models.DateTimeField(auto_now=True)\n    \n    class Meta:\n        abstract = True\n\nclass User(AbstractUser):\n    \"\"\"Custom user model with additional fields\"\"\"\n    id = models.UUIDField(primary_key=True, default=uuid.uuid4, editable=False)\n    email = models.EmailField(unique=True, validators=[EmailValidator()])\n    phone = models.CharField(max_length=20, blank=True)\n    avatar = models.ImageField(upload_to='avatars/', blank=True)\n    is_verified = models.BooleanField(default=False)\n    \n    USERNAME_FIELD = 'email'\n    REQUIRED_FIELDS = ['username', 'first_name', 'last_name']\n    \n    class Meta:\n        db_table = 'auth_user'\n        verbose_name = 'User'\n        verbose_name_plural = 'Users'\n\nclass Category(TimestampedModel):\n    \"\"\"Product category model\"\"\"\n    name = models.CharField(max_length=100, unique=True)\n    slug = models.SlugField(unique=True)\n    description = models.TextField(blank=True)\n    parent = models.ForeignKey('self', on_delete=models.CASCADE, null=True, blank=True)\n    is_active = models.BooleanField(default=True)\n    \n    class Meta:\n        verbose_name_plural = 'Categories'\n        ordering = ['name']\n    \n    def __str__(self):\n        return self.name\n    \n    def get_absolute_url(self):\n        return reverse('category:detail', kwargs={'slug': self.slug})\n\nclass Product(TimestampedModel):\n    \"\"\"Product model with advanced features\"\"\"\n    name = models.CharField(max_length=200)\n    slug = models.SlugField(unique=True)\n    description = models.TextField()\n    category = models.ForeignKey(Category, on_delete=models.CASCADE, related_name='products')\n    price = models.DecimalField(max_digits=10, decimal_places=2)\n    stock = models.PositiveIntegerField(default=0)\n    image = models.ImageField(upload_to='products/')\n    is_featured = models.BooleanField(default=False)\n    is_active = models.BooleanField(default=True)\n    \n    class Meta:\n        ordering = ['-created_at']\n        indexes = [\n            models.Index(fields=['slug']),\n            models.Index(fields=['category', 'is_active']),\n            models.Index(fields=['is_featured', 'is_active']),\n        ]\n    \n    def __str__(self):\n        return self.name\n    \n    def get_absolute_url(self):\n        return reverse('product:detail', kwargs={'slug': self.slug})\n    \n    @property\n    def is_in_stock(self):\n        return self.stock > 0\n    \n    def save(self, *args, **kwargs):\n        # Clear related cache when saving\n        cache.delete_many([\n            f'product:{self.slug}',\n            f'category_products:{self.category.slug}',\n            'featured_products'\n        ])\n        super().save(*args, **kwargs)\n\n# views.py\nfrom django.shortcuts import render, get_object_or_404\nfrom django.http import JsonResponse, HttpResponse\nfrom django.views.generic import ListView, DetailView, CreateView, UpdateView\nfrom django.contrib.auth.mixins import LoginRequiredMixin\nfrom django.contrib.auth.decorators import login_required\nfrom django.core.paginator import Paginator\nfrom django.db.models import Q, Count, Avg\nfrom django.core.cache import cache\nfrom django.utils.decorators import method_decorator\nfrom django.views.decorators.cache import cache_page\nfrom django.views.decorators.csrf import csrf_exempt\nimport json\nfrom .models import Product, Category, User\nfrom .forms import ProductForm, CategoryForm\nfrom .serializers import ProductSerializer, CategorySerializer\n\nclass ProductListView(ListView):\n    \"\"\"Product list view with filtering and pagination\"\"\"\n    model = Product\n    template_name = 'products/list.html'\n    context_object_name = 'products'\n    paginate_by = 12\n    \n    def get_queryset(self):\n        queryset = Product.objects.filter(is_active=True).select_related('category')\n        \n        # Search functionality\n        search = self.request.GET.get('search')\n        if search:\n            queryset = queryset.filter(\n                Q(name__icontains=search) | \n                Q(description__icontains=search)\n            )\n        \n        # Category filter\n        category_slug = self.request.GET.get('category')\n        if category_slug:\n            queryset = queryset.filter(category__slug=category_slug)\n        \n        # Price range filter\n        min_price = self.request.GET.get('min_price')\n        max_price = self.request.GET.get('max_price')\n        if min_price:\n            queryset = queryset.filter(price__gte=min_price)\n        if max_price:\n            queryset = queryset.filter(price__lte=max_price)\n        \n        # Sorting\n        sort_by = self.request.GET.get('sort', 'name')\n        if sort_by in ['name', 'price', 'created_at']:\n            queryset = queryset.order_by(sort_by)\n        \n        return queryset\n    \n    def get_context_data(self, **kwargs):\n        context = super().get_context_data(**kwargs)\n        context['categories'] = Category.objects.filter(is_active=True)\n        context['search_query'] = self.request.GET.get('search', '')\n        return context\n\nclass ProductDetailView(DetailView):\n    \"\"\"Product detail view with caching\"\"\"\n    model = Product\n    template_name = 'products/detail.html'\n    context_object_name = 'product'\n    slug_field = 'slug'\n    slug_url_kwarg = 'slug'\n    \n    def get_object(self):\n        slug = self.kwargs.get('slug')\n        cache_key = f'product:{slug}'\n        \n        # Try to get from cache first\n        product = cache.get(cache_key)\n        if not product:\n            product = get_object_or_404(\n                Product.objects.select_related('category'),\n                slug=slug,\n                is_active=True\n            )\n            # Cache for 15 minutes\n            cache.set(cache_key, product, 60 * 15)\n        \n        return product\n    \n    def get_context_data(self, **kwargs):\n        context = super().get_context_data(**kwargs)\n        \n        # Related products\n        context['related_products'] = Product.objects.filter(\n            category=self.object.category,\n            is_active=True\n        ).exclude(id=self.object.id)[:4]\n        \n        return context\n\nclass ProductCreateView(LoginRequiredMixin, CreateView):\n    \"\"\"Product creation view\"\"\"\n    model = Product\n    form_class = ProductForm\n    template_name = 'products/create.html'\n    \n    def form_valid(self, form):\n        form.instance.created_by = self.request.user\n        return super().form_valid(form)\n\n# API Views\n@csrf_exempt\ndef api_products_list(request):\n    \"\"\"REST API endpoint for products\"\"\"\n    if request.method == 'GET':\n        products = Product.objects.filter(is_active=True).select_related('category')\n        \n        # Filtering\n        category = request.GET.get('category')\n        if category:\n            products = products.filter(category__slug=category)\n        \n        # Pagination\n        page = int(request.GET.get('page', 1))\n        limit = min(int(request.GET.get('limit', 10)), 100)  # Max 100 items\n        \n        paginator = Paginator(products, limit)\n        page_obj = paginator.get_page(page)\n        \n        data = {\n            'products': ProductSerializer(page_obj.object_list, many=True).data,\n            'pagination': {\n                'page': page,\n                'pages': paginator.num_pages,\n                'has_next': page_obj.has_next(),\n                'has_previous': page_obj.has_previous(),\n                'total': paginator.count\n            }\n        }\n        \n        return JsonResponse(data)\n    \n    elif request.method == 'POST':\n        try:\n            data = json.loads(request.body)\n            serializer = ProductSerializer(data=data)\n            \n            if serializer.is_valid():\n                product = serializer.save()\n                return JsonResponse(\n                    ProductSerializer(product).data,\n                    status=201\n                )\n            else:\n                return JsonResponse(\n                    {'errors': serializer.errors},\n                    status=400\n                )\n        except json.JSONDecodeError:\n            return JsonResponse(\n                {'error': 'Invalid JSON'},\n                status=400\n            )\n    \n    return JsonResponse({'error': 'Method not allowed'}, status=405)\n\n# forms.py\nfrom django import forms\nfrom django.core.exceptions import ValidationError\nfrom .models import Product, Category\n\nclass ProductForm(forms.ModelForm):\n    \"\"\"Product form with validation\"\"\"\n    \n    class Meta:\n        model = Product\n        fields = ['name', 'slug', 'description', 'category', 'price', 'stock', 'image', 'is_featured']\n        widgets = {\n            'description': forms.Textarea(attrs={'rows': 4}),\n            'price': forms.NumberInput(attrs={'step': '0.01'}),\n        }\n    \n    def clean_slug(self):\n        slug = self.cleaned_data['slug']\n        if Product.objects.filter(slug=slug).exclude(pk=self.instance.pk).exists():\n            raise ValidationError('A product with this slug already exists.')\n        return slug\n    \n    def clean_price(self):\n        price = self.cleaned_data['price']\n        if price <= 0:\n            raise ValidationError('Price must be greater than zero.')\n        return price\n\n# serializers.py (Django REST Framework style)\nclass ProductSerializer:\n    \"\"\"Product serializer for API responses\"\"\"\n    \n    def __init__(self, instance=None, data=None, many=False):\n        self.instance = instance\n        self.data_input = data\n        self.many = many\n        self._errors = {}\n    \n    @property\n    def data(self):\n        if self.many:\n            return [self._serialize_product(product) for product in self.instance]\n        return self._serialize_product(self.instance)\n    \n    def _serialize_product(self, product):\n        return {\n            'id': str(product.id) if hasattr(product, 'id') else None,\n            'name': product.name,\n            'slug': product.slug,\n            'description': product.description,\n            'category': {\n                'id': product.category.id,\n                'name': product.category.name,\n                'slug': product.category.slug\n            } if product.category else None,\n            'price': str(product.price),\n            'stock': product.stock,\n            'is_featured': product.is_featured,\n            'created_at': product.created_at.isoformat() if product.created_at else None,\n            'updated_at': product.updated_at.isoformat() if product.updated_at else None,\n        }\n    \n    def is_valid(self):\n        # Implement validation logic\n        if not self.data_input:\n            self._errors['general'] = ['No data provided']\n            return False\n        \n        required_fields = ['name', 'description', 'category', 'price']\n        for field in required_fields:\n            if field not in self.data_input:\n                self._errors[field] = ['This field is required']\n        \n        return len(self._errors) == 0\n    \n    @property\n    def errors(self):\n        return self._errors\n    \n    def save(self):\n        if not self.is_valid():\n            raise ValidationError(self.errors)\n        \n        category = Category.objects.get(id=self.data_input['category'])\n        product = Product.objects.create(\n            name=self.data_input['name'],\n            description=self.data_input['description'],\n            category=category,\n            price=self.data_input['price'],\n            stock=self.data_input.get('stock', 0),\n            is_featured=self.data_input.get('is_featured', False)\n        )\n        return product\n\n# urls.py\nfrom django.urls import path, include\nfrom . import views\n\napp_name = 'products'\n\nurlpatterns = [\n    # Web URLs\n    path('', views.ProductListView.as_view(), name='list'),\n    path('create/', views.ProductCreateView.as_view(), name='create'),\n    path('<slug:slug>/', views.ProductDetailView.as_view(), name='detail'),\n    \n    # API URLs\n    path('api/products/', views.api_products_list, name='api_products_list'),\n]\n\n# settings.py additions\nCACHES = {\n    'default': {\n        'BACKEND': 'django_redis.cache.RedisCache',\n        'LOCATION': 'redis://127.0.0.1:6379/1',\n        'OPTIONS': {\n            'CLIENT_CLASS': 'django_redis.client.DefaultClient',\n        }\n    }\n}\n\n# Logging configuration\nLOGGING = {\n    'version': 1,\n    'disable_existing_loggers': False,\n    'handlers': {\n        'file': {\n            'level': 'INFO',\n            'class': 'logging.FileHandler',\n            'filename': 'django.log',\n        },\n    },\n    'loggers': {\n        'django': {\n            'handlers': ['file'],\n            'level': 'INFO',\n            'propagate': True,\n        },\n    },\n}\n'''",
  "code_hash": "9ec94b5d6830f83fe7676f5f91e08d208ae405f85c5f5ddf728df9810695f4b6",
  "imports": [],
  "exports": {},
  "parameters": [],
  "dependencies": [],
  "token_count": 3300,
  "times_used": 0,
  "total_tokens_saved": 0,
  "validation_status": "pending",
  "tags": [
    "django",
    "ai",
    "ml",
    "redis"
  ],
  "source_file": "/storage/emulated/0/Download/integrate ideas/Generators/python_generator.py",
  "source_line": null,
  "docstring": "Generate Django application with modern patterns",
  "created_at": "2026-01-01T22:45:33.833398",
  "last_used": null,
  "is_active": true
}