{
  "code": "extern \"C\" {\n\nvoid BLOCK-PY-00221_execute() {\n    def _generate_fullstack_compose(self, complexity: str) -> str:\n        \"\"\"Generate full-stack Docker Compose with all services\"\"\"\n        if complexity == 'high':\n            return \"\"\"# Full-Stack Production Docker Compose\nversion: '3.8'\n\n# Define custom networks\nnetworks:\n  frontend:\n    driver: bridge\n  backend:\n    driver: bridge\n  database:\n    driver: bridge\n    internal: true\n\n# Define persistent volumes\nvolumes:\n  postgres_data:\n    driver: local\n  redis_data:\n    driver: local\n  elasticsearch_data:\n    driver: local\n  grafana_data:\n    driver: local\n  prometheus_data:\n    driver: local\n\nservices:\n  # Reverse Proxy & Load Balancer\n  nginx:\n    image: nginx:1.24-alpine\n    container_name: nginx-proxy\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    volumes:\n      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro\n      - ./nginx/ssl:/etc/nginx/ssl:ro\n      - ./nginx/logs:/var/log/nginx\n    networks:\n      - frontend\n      - backend\n    depends_on:\n      - web-app\n      - api-server\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 40s\n    logging:\n      driver: \"json-file\"\n      options:\n        max-size: \"10m\"\n        max-file: \"3\"\n\n  # Frontend React Application\n  web-app:\n    build:\n      context: ./frontend\n      dockerfile: Dockerfile.prod\n      args:\n        - NODE_ENV=production\n        - BUILD_DATE=${BUILD_DATE:-$(date -u +'%Y-%m-%dT%H:%M:%SZ')}\n        - VCS_REF=${VCS_REF:-$(git rev-parse --short HEAD)}\n    container_name: react-app\n    environment:\n      - NODE_ENV=production\n      - REACT_APP_API_URL=https://api.company.com\n      - REACT_APP_SENTRY_DSN=${SENTRY_DSN}\n    networks:\n      - frontend\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:3000/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n    depends_on:\n      api-server:\n        condition: service_healthy\n    labels:\n      - \"traefik.enable=true\"\n      - \"traefik.http.routers.webapp.rule=Host(`app.company.com`)\"\n      - \"traefik.http.services.webapp.loadbalancer.server.port=3000\"\n\n  # Backend API Server\n  api-server:\n    build:\n      context: ./backend\n      dockerfile: Dockerfile.prod\n      args:\n        - APP_ENV=production\n        - BUILD_DATE=${BUILD_DATE:-$(date -u +'%Y-%m-%dT%H:%M:%SZ')}\n    container_name: api-server\n    environment:\n      - NODE_ENV=production\n      - DATABASE_URL=postgresql://app_user:${DB_PASSWORD}@postgres:5432/app_db\n      - REDIS_URL=redis://redis:6379\n      - JWT_SECRET=${JWT_SECRET}\n      - SENTRY_DSN=${SENTRY_DSN}\n      - LOG_LEVEL=info\n    networks:\n      - backend\n      - database\n    depends_on:\n      postgres:\n        condition: service_healthy\n      redis:\n        condition: service_healthy\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD\", \"curl\", \"-f\", \"http://localhost:8000/health\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n      start_period: 30s\n    labels:\n      - \"traefik.enable=true\" \n      - \"traefik.http.routers.api.rule=Host(`api.company.com`)\"\n      - \"traefik.http.services.api.loadbalancer.server.port=8000\"\n\n  # PostgreSQL Database\n  postgres:\n    image: postgres:15-alpine\n    container_name: postgres-db\n    environment:\n      - POSTGRES_DB=app_db\n      - POSTGRES_USER=app_user\n      - POSTGRES_PASSWORD=${DB_PASSWORD}\n      - POSTGRES_INITDB_ARGS=--auth-host=scram-sha-256\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n      - ./database/init.sql:/docker-entrypoint-initdb.d/init.sql:ro\n      - ./database/postgresql.conf:/etc/postgresql/postgresql.conf:ro\n    networks:\n      - database\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U app_user -d app_db\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n    command: >\n      postgres \n      -c config_file=/etc/postgresql/postgresql.conf\n      -c shared_preload_libraries=pg_stat_statements\n      -c logging_collector=on\n      -c log_destination=csvlog\n    \n  # Redis Cache\n  redis:\n    image: redis:7-alpine\n    container_name: redis-cache\n    command: redis-server --requirepass ${REDIS_PASSWORD} --maxmemory 256mb --maxmemory-policy allkeys-lru\n    volumes:\n      - redis_data:/data\n      - ./redis/redis.conf:/etc/redis/redis.conf:ro\n    networks:\n      - database\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"--raw\", \"incr\", \"ping\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n  # Message Queue\n  rabbitmq:\n    image: rabbitmq:3.12-management-alpine\n    container_name: rabbitmq-queue\n    environment:\n      - RABBITMQ_DEFAULT_USER=admin\n      - RABBITMQ_DEFAULT_PASS=${RABBITMQ_PASSWORD}\n      - RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS=-rabbit log_levels [{connection,error},{default,info}]\n    volumes:\n      - ./rabbitmq/data:/var/lib/rabbitmq\n      - ./rabbitmq/logs:/var/log/rabbitmq\n    networks:\n      - backend\n    ports:\n      - \"15672:15672\"  # Management UI\n    restart: unless-stopped\n    healthcheck:\n      test: rabbitmq-diagnostics -q ping\n      interval: 30s\n      timeout: 30s\n      retries: 3\n\n  # Elasticsearch for Logging\n  elasticsearch:\n    image: elasticsearch:8.8.1\n    container_name: elasticsearch\n    environment:\n      - discovery.type=single-node\n      - \"ES_JAVA_OPTS=-Xms512m -Xmx512m\"\n      - xpack.security.enabled=false\n    volumes:\n      - elasticsearch_data:/usr/share/elasticsearch/data\n    networks:\n      - backend\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD-SHELL\", \"curl -f http://localhost:9200/_cluster/health || exit 1\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n  # Monitoring with Prometheus\n  prometheus:\n    image: prom/prometheus:latest\n    container_name: prometheus\n    command:\n      - '--config.file=/etc/prometheus/prometheus.yml'\n      - '--storage.tsdb.path=/prometheus'\n      - '--web.console.libraries=/etc/prometheus/console_libraries'\n      - '--web.console.templates=/etc/prometheus/consoles'\n      - '--storage.tsdb.retention.time=200h'\n      - '--web.enable-lifecycle'\n    volumes:\n      - ./monitoring/prometheus.yml:/etc/prometheus/prometheus.yml:ro\n      - prometheus_data:/prometheus\n    networks:\n      - backend\n    ports:\n      - \"9090:9090\"\n    restart: unless-stopped\n    healthcheck:\n      test: [\"CMD\", \"wget\", \"--no-verbose\", \"--tries=1\", \"--spider\", \"http://localhost:9090/\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n  # Grafana Dashboards\n  grafana:\n    image: grafana/grafana:latest\n    container_name: grafana\n    environment:\n      - GF_SECURITY_ADMIN_USER=admin\n      - GF_SECURITY_ADMIN_PASSWORD=${GRAFANA_PASSWORD}\n      - GF_USERS_ALLOW_SIGN_UP=false\n    volumes:\n      - grafana_data:/var/lib/grafana\n      - ./monitoring/grafana/provisioning:/etc/grafana/provisioning:ro\n      - ./monitoring/grafana/dashboards:/var/lib/grafana/dashboards:ro\n    networks:\n      - backend\n    ports:\n      - \"3001:3000\"\n    restart: unless-stopped\n    depends_on:\n      - prometheus\n    healthcheck:\n      test: [\"CMD-SHELL\", \"curl -f http://localhost:3000/api/health || exit 1\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n# Development override file: docker-compose.override.yml\n# Use: docker-compose -f docker-compose.yml -f docker-compose.override.yml up\"\"\"\n        \n        elif complexity == 'medium':\n            return \"\"\"# Full-Stack Docker Compose\nversion: '3.8'\n\nnetworks:\n  app-network:\n    driver: bridge\n\nvolumes:\n  postgres_data:\n  redis_data:\n\nservices:\n  # Frontend\n  web-app:\n    build: ./frontend\n    container_name: react-app\n    ports:\n      - \"3000:3000\"\n    environment:\n      - NODE_ENV=production\n      - REACT_APP_API_URL=http://localhost:8000\n    networks:\n      - app-network\n    depends_on:\n      - api-server\n\n  # Backend API\n  api-server:\n    build: ./backend  \n    container_name: api-server\n    ports:\n      - \"8000:8000\"\n    environment:\n      - DATABASE_URL=postgresql://user:password@postgres:5432/app_db\n      - REDIS_URL=redis://redis:6379\n    networks:\n      - app-network\n    depends_on:\n      - postgres\n      - redis\n\n  # Database\n  postgres:\n    image: postgres:15-alpine\n    container_name: postgres-db\n    environment:\n      - POSTGRES_DB=app_db\n      - POSTGRES_USER=user\n      - POSTGRES_PASSWORD=password\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    networks:\n      - app-network\n    healthcheck:\n      test: [\"CMD-SHELL\", \"pg_isready -U user\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n\n  # Cache\n  redis:\n    image: redis:7-alpine\n    container_name: redis-cache\n    volumes:\n      - redis_data:/data\n    networks:\n      - app-network\n    healthcheck:\n      test: [\"CMD\", \"redis-cli\", \"ping\"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\"\"\"\n        \n        else:  # simple\n            return \"\"\"# Simple Docker Compose\nversion: '3.8'\n\nservices:\n  web:\n    build: .\n    ports:\n      - \"3000:3000\"\n    environment:\n      - NODE_ENV=production\n    depends_on:\n      - db\n\n  db:\n    image: postgres:15-alpine\n    environment:\n      - POSTGRES_DB=app_db\n      - POSTGRES_USER=user\n      - POSTGRES_PASSWORD=password\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n\nvolumes:\n  postgres_data:\"\"\"\n}\n\n} // extern \"C\"\n",
  "id": "BLOCK-PY-00221",
  "language": "python",
  "source_file": "/storage/emulated/0/Download/integrate ideas/Generators/devops_generator.py",
  "source_line": 0,
  "validation_status": "validated"
}